<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Defends - Tower Defense</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Adicionar Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { font-family: 'Poppins', sans-serif; }
        html, body { overflow-x: hidden; }
        .game-screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        .main-menu-card {
            background: linear-gradient(145deg, #1f2937, #111827);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 500px;
            width: 100%;
        }
        .defense-container {
            width: 90vw;
            max-width: 750px;
            aspect-ratio: 16 / 9;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        #gameCanvas {
            border: 2px solid #6366f1;
            background-color: #27272a;
            cursor: pointer;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal-content {
            background: #1f2937;
            border: 1px solid #6366f1;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.7);
        }
        .category-card {
            transition: all 0.2s;
        }
        .category-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
        }
        .password-container {
            position: relative;
        }
        .disabled-tower {
            opacity: 0.5;
            filter: grayscale(100%);
            cursor: not-allowed;
        }
        .destroyer-timer {
            position: absolute;
            color: #ff0000;
            font-weight: bold;
            font-size: 10px;
            text-shadow: 0 0 3px black;
        }
        .quiz-answered {
            opacity: 0.6;
            filter: grayscale(50%);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-indigo-950 to-gray-900 text-white min-h-screen">

    <div id="app" class="game-screen">
        <div id="game-content" class="w-full max-w-4xl"></div>
        <div id="notification-box" class="fixed bottom-4 right-4 p-3 bg-green-500 text-white rounded-lg shadow-lg hidden z-50"></div>
    </div>

    <div id="custom-modal" class="modal-overlay hidden">
        <div class="modal-content p-6 rounded-xl w-80 text-center">
            <h3 id="modal-title" class="text-xl font-bold mb-3 text-indigo-400"></h3>
            <p id="modal-message" class="mb-5 text-gray-300"></p>
            <div id="modal-buttons"></div>
        </div>
    </div>

    <script>
        // Configuração do Supabase
        const SUPABASE_URL = 'https://glqvbnxjxlczsypigmfe.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdscXZibnhqeGxjenN5cGlnbWZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2NTI4NjQsImV4cCI6MjA4MTIyODg2NH0.vbgeT0gJBIPieT77_KUHD5JNvbd4X3CQUpuZtLAdZFc';
        
        // Inicializar Supabase
        const supa = window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

        const TOWERS = [
            { id: 0, name: 'Basic Turret', cost: 15, damage: 10, range: 2, fireRate: 1000, color: '#4CAF50', laserColor: '#76FF03', description: 'Cheap & reliable' },
            { id: 1, name: 'Laser Tower', cost: 30, damage: 20, range: 2.5, fireRate: 800, color: '#2196F3', laserColor: '#00E5FF', description: 'Balanced power' },
            { id: 2, name: 'Plasma Cannon', cost: 50, damage: 45, range: 3, fireRate: 1200, color: '#9C27B0', laserColor: '#EA80FC', description: 'High damage shots' },
            { id: 3, name: 'Rapid Fire', cost: 40, damage: 8, range: 2, fireRate: 200, color: '#FF9800', laserColor: '#FFEA00', description: 'Very fast shots' },
            { id: 4, name: 'Sniper Tower', cost: 75, damage: 80, range: 5, fireRate: 2000, color: '#F44336', laserColor: '#FF1744', description: 'Long range killer' },
            { id: 5, name: 'Tesla Coil', cost: 100, damage: 25, range: 2.5, fireRate: 600, color: '#00BCD4', laserColor: '#18FFFF', chainTargets: 3, description: 'Chain lightning!' },
            { id: 6, name: 'Freeze Ray', cost: 60, damage: 15, range: 2.5, fireRate: 1000, color: '#E3F2FD', laserColor: '#81D4FA', slowEffect: 0.5, slowDuration: 2000, description: 'Slows enemies' },
            { id: 7, name: 'Death Ray', cost: 150, damage: 100, range: 4, fireRate: 1500, color: '#880E4F', laserColor: '#FF0000', description: 'Ultimate power!' },
            // Updated: Destroyer now shoots like Rapid Fire (fireRate: 200 instead of 3000)
            { id: 8, name: 'Destroyer', cost: 1000, damage: 300, range: 4, fireRate: 200, color: '#000000', laserColor: '#FF6B00', 
              description: 'Temporário (7 min), não pode mover/vender', availableAtWave: 25, temporary: true, duration: 420000 },
            // Updated: Super Freeze now shoots like Rapid Fire (fireRate: 200 instead of 1200)
            { id: 9, name: 'Super Freeze', cost: 500, damage: 20, range: 3, fireRate: 200, color: '#00BFFF', laserColor: '#87CEFA', 
              slowEffect: 0.5, slowDuration: 6000, description: '3x freeze time' }
        ];

        const QUIZ_QUESTIONS = {
            Maths: [
                { q: "What is 5 + 3?", a: "8", options: ["7", "8", "9", "10"] },
                { q: "What is 10 - 4?", a: "6", options: ["5", "6", "7", "8"] },
                { q: "What is 2 × 3?", a: "6", options: ["5", "6", "7", "8"] },
                { q: "What is 12 ÷ 4?", a: "3", options: ["2", "3", "4", "5"] },
                { q: "What is 7 + 8?", a: "15", options: ["14", "15", "16", "17"] },
                { q: "What is 20 - 7?", a: "13", options: ["12", "13", "14", "15"] },
                { q: "What is 4 × 5?", a: "20", options: ["15", "20", "25", "30"] },
                { q: "What is 18 ÷ 3?", a: "6", options: ["5", "6", "7", "8"] },
                { q: "What is 9 + 6?", a: "15", options: ["14", "15", "16", "17"] },
                { q: "What is 15 - 8?", a: "7", options: ["6", "7", "8", "9"] },
                { q: "What is 3 × 7?", a: "21", options: ["20", "21", "22", "24"] },
                { q: "What is 24 ÷ 6?", a: "4", options: ["3", "4", "5", "6"] },
                { q: "What is 11 + 9?", a: "20", options: ["19", "20", "21", "22"] },
                { q: "What is 30 - 12?", a: "18", options: ["17", "18", "19", "20"] },
                { q: "What is 6 × 4?", a: "24", options: ["20", "24", "28", "30"] },
                { q: "What is 35 ÷ 7?", a: "5", options: ["4", "5", "6", "7"] },
                { q: "What is 14 + 7?", a: "21", options: ["20", "21", "22", "23"] },
                { q: "What is 25 - 9?", a: "16", options: ["15", "16", "17", "18"] },
                { q: "What is 8 × 3?", a: "24", options: ["21", "24", "27", "30"] },
                { q: "What is 40 ÷ 8?", a: "5", options: ["4", "5", "6", "8"] },
                { q: "What is 13 + 8?", a: "21", options: ["20", "21", "22", "19"] },
                { q: "What is 22 - 6?", a: "16", options: ["15", "16", "17", "14"] },
                { q: "What is 5 × 9?", a: "45", options: ["40", "45", "50", "54"] },
                { q: "What is 27 ÷ 3?", a: "9", options: ["8", "9", "10", "7"] },
                { q: "What is 16 + 5?", a: "21", options: ["20", "21", "22", "23"] },
                { q: "What is 19 - 7?", a: "12", options: ["11", "12", "13", "10"] },
                { q: "What is 7 × 6?", a: "42", options: ["40", "42", "48", "36"] },
                { q: "What is 36 ÷ 4?", a: "9", options: ["8", "9", "10", "7"] },
                { q: "What is 18 + 12?", a: "30", options: ["28", "30", "32", "29"] },
                { q: "What is 28 - 11?", a: "17", options: ["16", "17", "18", "15"] },
                { q: "What is 9 × 4?", a: "36", options: ["32", "36", "40", "35"] },
                { q: "What is 45 ÷ 9?", a: "5", options: ["4", "5", "6", "7"] },
                { q: "What is 23 + 8?", a: "31", options: ["30", "31", "32", "29"] },
                { q: "What is 33 - 14?", a: "19", options: ["18", "19", "20", "17"] },
                { q: "What is 8 × 7?", a: "56", options: ["54", "56", "63", "49"] },
                { q: "What is 48 ÷ 6?", a: "8", options: ["7", "8", "9", "6"] },
                { q: "What is 26 + 15?", a: "41", options: ["40", "41", "42", "39"] },
                { q: "What is 37 - 18?", a: "19", options: ["18", "19", "20", "21"] },
                { q: "What is 6 × 9?", a: "54", options: ["56", "54", "63", "48"] },
                { q: "What is 56 ÷ 8?", a: "7", options: ["6", "7", "8", "9"] },
                { q: "What is 29 + 13?", a: "42", options: ["41", "42", "43", "40"] },
                { q: "What is 41 - 16?", a: "25", options: ["24", "25", "26", "23"] },
                { q: "What is 9 × 8?", a: "72", options: ["70", "72", "81", "64"] },
                { q: "What is 63 ÷ 7?", a: "9", options: ["8", "9", "10", "7"] },
                { q: "What is 34 + 17?", a: "51", options: ["50", "51", "52", "49"] },
                { q: "What is 44 - 19?", a: "25", options: ["24", "25", "26", "27"] },
                { q: "What is 7 × 9?", a: "63", options: ["56", "63", "72", "54"] },
                { q: "What is 72 ÷ 9?", a: "8", options: ["7", "8", "9", "6"] },
                { q: "What is 38 + 24?", a: "62", options: ["60", "62", "64", "61"] },
                { q: "What is 50 - 23?", a: "27", options: ["26", "27", "28", "25"] }
            ],
            World: [
                { q: "What planet do we live on?", a: "Earth", options: ["Mars", "Earth", "Venus", "Jupiter"] },
                { q: "What is the largest ocean?", a: "Pacific", options: ["Atlantic", "Pacific", "Indian", "Arctic"] },
                { q: "How many continents are there?", a: "7", options: ["5", "6", "7", "8"] },
                { q: "What is the tallest mountain?", a: "Mount Everest", options: ["K2", "Mount Everest", "Alps", "Andes"] },
                { q: "What color is the sky?", a: "Blue", options: ["Red", "Blue", "Green", "Yellow"] },
                { q: "What do bees make?", a: "Honey", options: ["Milk", "Honey", "Butter", "Cheese"] },
                { q: "How many legs does a spider have?", a: "8", options: ["6", "8", "4", "10"] },
                { q: "What is the capital of France?", a: "Paris", options: ["London", "Paris", "Berlin", "Rome"] },
                { q: "What animal says 'meow'?", a: "Cat", options: ["Dog", "Cat", "Cow", "Pig"] },
                { q: "What do plants need to grow?", a: "Sunlight", options: ["Darkness", "Sunlight", "Ice", "Fire"] },
                { q: "How many days in a week?", a: "7", options: ["5", "6", "7", "8"] },
                { q: "What is the hottest season?", a: "Summer", options: ["Winter", "Spring", "Summer", "Fall"] },
                { q: "What animal has a trunk?", a: "Elephant", options: ["Lion", "Elephant", "Tiger", "Bear"] },
                { q: "What is frozen water called?", a: "Ice", options: ["Steam", "Ice", "Rain", "Snow"] },
                { q: "How many colors in a rainbow?", a: "7", options: ["5", "6", "7", "8"] },
                { q: "What is the fastest land animal?", a: "Cheetah", options: ["Lion", "Cheetah", "Horse", "Dog"] },
                { q: "What do cows give us?", a: "Milk", options: ["Eggs", "Milk", "Honey", "Wool"] },
                { q: "What is the largest animal?", a: "Blue Whale", options: ["Elephant", "Blue Whale", "Giraffe", "Shark"] },
                { q: "How many months in a year?", a: "12", options: ["10", "11", "12", "13"] },
                { q: "What is the coldest season?", a: "Winter", options: ["Summer", "Winter", "Spring", "Fall"] },
                { q: "What animal can fly?", a: "Bird", options: ["Dog", "Cat", "Bird", "Fish"] },
                { q: "What do chickens lay?", a: "Eggs", options: ["Milk", "Eggs", "Honey", "Wool"] },
                { q: "What is the sun?", a: "A star", options: ["A planet", "A star", "A moon", "A comet"] },
                { q: "How many fingers on one hand?", a: "5", options: ["4", "5", "6", "10"] },
                { q: "What is the capital of England?", a: "London", options: ["Paris", "London", "Berlin", "Rome"] },
                { q: "What animal lives in water?", a: "Fish", options: ["Dog", "Cat", "Fish", "Bird"] },
                { q: "What do we use to see?", a: "Eyes", options: ["Ears", "Eyes", "Nose", "Mouth"] },
                { q: "What is the tallest animal?", a: "Giraffe", options: ["Elephant", "Giraffe", "Horse", "Bear"] },
                { q: "How many sides does a triangle have?", a: "3", options: ["2", "3", "4", "5"] },
                { q: "What is the capital of Italy?", a: "Rome", options: ["Paris", "London", "Rome", "Berlin"] },
                { q: "What animal says 'woof'?", a: "Dog", options: ["Cat", "Dog", "Cow", "Pig"] },
                { q: "What do we use to hear?", a: "Ears", options: ["Eyes", "Ears", "Nose", "Mouth"] },
                { q: "What is the smallest continent?", a: "Australia", options: ["Asia", "Australia", "Europe", "Africa"] },
                { q: "How many sides does a square have?", a: "4", options: ["3", "4", "5", "6"] },
                { q: "What is the capital of Spain?", a: "Madrid", options: ["Barcelona", "Madrid", "Seville", "Valencia"] },
                { q: "What animal says 'moo'?", a: "Cow", options: ["Dog", "Cat", "Cow", "Pig"] },
                { q: "What do we use to smell?", a: "Nose", options: ["Eyes", "Ears", "Nose", "Mouth"] },
                { q: "What is the longest river?", a: "Nile", options: ["Amazon", "Nile", "Yangtze", "Mississippi"] },
                { q: "How many sides does a circle have?", a: "0", options: ["0", "1", "2", "3"] },
                { q: "What is the capital of Germany?", a: "Berlin", options: ["Paris", "London", "Berlin", "Rome"] },
                { q: "What animal says 'oink'?", a: "Pig", options: ["Dog", "Cat", "Cow", "Pig"] },
                { q: "What do we use to taste?", a: "Tongue", options: ["Eyes", "Ears", "Nose", "Tongue"] },
                { q: "What is the largest desert?", a: "Sahara", options: ["Gobi", "Sahara", "Arabian", "Kalahari"] },
                { q: "How many wheels on a bicycle?", a: "2", options: ["1", "2", "3", "4"] },
                { q: "What is the capital of Japan?", a: "Tokyo", options: ["Beijing", "Tokyo", "Seoul", "Bangkok"] },
                { q: "What animal has stripes?", a: "Zebra", options: ["Lion", "Zebra", "Elephant", "Bear"] },
                { q: "What do we use to walk?", a: "Legs", options: ["Arms", "Legs", "Hands", "Feet"] },
                { q: "What is the smallest ocean?", a: "Arctic", options: ["Atlantic", "Pacific", "Indian", "Arctic"] },
                { q: "How many wheels on a car?", a: "4", options: ["2", "3", "4", "5"] },
                { q: "What is the capital of China?", a: "Beijing", options: ["Tokyo", "Beijing", "Seoul", "Bangkok"] }
            ],
            History: [
                { q: "Who discovered America?", a: "Columbus", options: ["Magellan", "Columbus", "Cook", "Drake"] },
                { q: "When did WW2 end?", a: "1945", options: ["1944", "1945", "1946", "1943"] },
                { q: "Who was first US president?", a: "Washington", options: ["Lincoln", "Washington", "Jefferson", "Adams"] },
                { q: "What year did Titanic sink?", a: "1912", options: ["1910", "1912", "1914", "1920"] },
                { q: "Who built the pyramids?", a: "Egyptians", options: ["Romans", "Egyptians", "Greeks", "Mayans"] },
                { q: "When did man land on moon?", a: "1969", options: ["1968", "1969", "1970", "1965"] },
                { q: "Who invented the telephone?", a: "Bell", options: ["Edison", "Bell", "Tesla", "Morse"] },
                { q: "What year was internet created?", a: "1983", options: ["1980", "1983", "1990", "1995"] },
                { q: "Who painted Mona Lisa?", a: "Da Vinci", options: ["Picasso", "Da Vinci", "Van Gogh", "Monet"] },
                { q: "When did Berlin Wall fall?", a: "1989", options: ["1988", "1989", "1990", "1991"] },
                { q: "Who was first in space?", a: "Gagarin", options: ["Armstrong", "Gagarin", "Aldrin", "Glenn"] },
                { q: "What year did WW1 start?", a: "1914", options: ["1913", "1914", "1915", "1916"] },
                { q: "Who wrote Romeo and Juliet?", a: "Shakespeare", options: ["Dickens", "Shakespeare", "Austen", "Twain"] },
                { q: "When was America discovered?", a: "1492", options: ["1490", "1492", "1500", "1480"] },
                { q: "Who invented the lightbulb?", a: "Edison", options: ["Tesla", "Edison", "Bell", "Franklin"] },
                { q: "What year did Titanic sail?", a: "1912", options: ["1910", "1912", "1914", "1920"] },
                { q: "Who was Napoleon?", a: "Emperor", options: ["King", "Emperor", "General", "President"] },
                { q: "When did dinosaurs die?", a: "65M years ago", options: ["50M years ago", "65M years ago", "100M years ago", "200M years ago"] },
                { q: "Who discovered gravity?", a: "Newton", options: ["Einstein", "Newton", "Galileo", "Copernicus"] },
                { q: "What year was printing invented?", a: "1440", options: ["1400", "1440", "1500", "1450"] },
                { q: "Who was Cleopatra?", a: "Queen", options: ["Princess", "Queen", "Empress", "Pharaoh"] },
                { q: "When was Great Wall built?", a: "Ancient times", options: ["Medieval", "Ancient times", "Modern", "Recent"] },
                { q: "Who invented the airplane?", a: "Wright Bros", options: ["Edison", "Wright Bros", "Ford", "Bell"] },
                { q: "What year was TV invented?", a: "1927", options: ["1925", "1927", "1930", "1920"] },
                { q: "Who was Julius Caesar?", a: "Roman", options: ["Greek", "Roman", "Egyptian", "Persian"] },
                { q: "When was Eiffel Tower built?", a: "1889", options: ["1888", "1889", "1890", "1900"] },
                { q: "Who discovered penicillin?", a: "Fleming", options: ["Pasteur", "Fleming", "Curie", "Darwin"] },
                { q: "What year was car invented?", a: "1886", options: ["1880", "1886", "1890", "1900"] },
                { q: "Who was Alexander Great?", a: "Conqueror", options: ["King", "Conqueror", "Emperor", "General"] },
                { q: "When was Statue Liberty built?", a: "1886", options: ["1880", "1886", "1890", "1900"] },
                { q: "Who invented the radio?", a: "Marconi", options: ["Tesla", "Marconi", "Edison", "Bell"] },
                { q: "What year was computer invented?", a: "1940s", options: ["1930s", "1940s", "1950s", "1960s"] },
                { q: "Who was Genghis Khan?", a: "Mongol", options: ["Chinese", "Mongol", "Persian", "Turkish"] },
                { q: "When was Taj Mahal built?", a: "1600s", options: ["1500s", "1600s", "1700s", "1800s"] },
                { q: "Who invented the camera?", a: "Daguerre", options: ["Edison", "Daguerre", "Bell", "Morse"] },
                { q: "What year was bicycle invented?", a: "1817", options: ["1810", "1817", "1820", "1830"] },
                { q: "Who was Joan of Arc?", a: "French", options: ["English", "French", "Spanish", "Italian"] },
                { q: "When was Colosseum built?", a: "80 AD", options: ["50 AD", "80 AD", "100 AD", "200 AD"] },
                { q: "Who invented the telescope?", a: "Galileo", options: ["Newton", "Galileo", "Copernicus", "Kepler"] },
                { q: "What year was steam engine invented?", a: "1712", options: ["1700", "1712", "1720", "1750"] },
                { q: "Who was Marco Polo?", a: "Explorer", options: ["Sailor", "Explorer", "Merchant", "Soldier"] },
                { q: "When was Machu Picchu built?", a: "1450", options: ["1400", "1450", "1500", "1550"] },
                { q: "Who invented the compass?", a: "Chinese", options: ["Arabs", "Chinese", "Greeks", "Romans"] },
                { q: "What year was gunpowder invented?", a: "900s", options: ["800s", "900s", "1000s", "1100s"] },
                { q: "Who was Spartacus?", a: "Gladiator", options: ["General", "Gladiator", "Emperor", "Senator"] },
                { q: "When was Petra built?", a: "300 BC", options: ["200 BC", "300 BC", "400 BC", "100 BC"] },
                { q: "Who invented paper?", a: "Chinese", options: ["Egyptians", "Chinese", "Romans", "Greeks"] },
                { q: "What year was wheel invented?", a: "3500 BC", options: ["3000 BC", "3500 BC", "4000 BC", "2500 BC"] },
                { q: "Who was Hannibal?", a: "Carthaginian", options: ["Roman", "Carthaginian", "Greek", "Persian"] },
                { q: "When was Stonehenge built?", a: "3000 BC", options: ["2000 BC", "3000 BC", "4000 BC", "1000 BC"] }
            ],
            Tech: [
                { q: "What does CPU stand for?", a: "Central Processing Unit", options: ["Computer Personal Unit", "Central Processing Unit", "Core Program Utility", "Central Program Unit"] },
                { q: "Who founded Apple?", a: "Steve Jobs", options: ["Bill Gates", "Steve Jobs", "Elon Musk", "Mark Zuckerberg"] },
                { q: "What does HTML stand for?", a: "HyperText Markup Language", options: ["High Tech Machine Learning", "HyperText Markup Language", "Home Tool Markup Language", "Hyper Transfer Markup"] },
                { q: "What year was first iPhone?", a: "2007", options: ["2005", "2007", "2008", "2006"] },
                { q: "Who created Android?", a: "Google", options: ["Apple", "Google", "Microsoft", "Samsung"] },
                { q: "What is a mouse used for?", a: "Pointing", options: ["Typing", "Pointing", "Printing", "Calling"] },
                { q: "What does WWW stand for?", a: "World Wide Web", options: ["World Wide Web", "World Web Wide", "Wide World Web", "Web World Wide"] },
                { q: "What is a keyboard for?", a: "Typing", options: ["Pointing", "Typing", "Printing", "Calling"] },
                { q: "Who founded Microsoft?", a: "Bill Gates", options: ["Steve Jobs", "Bill Gates", "Elon Musk", "Mark Zuckerberg"] },
                { q: "What does USB stand for?", a: "Universal Serial Bus", options: ["United Serial Bus", "Universal Serial Bus", "Universal System Bus", "United System Bus"] },
                { q: "What is a monitor?", a: "Screen", options: ["Keyboard", "Screen", "Mouse", "Printer"] },
                { q: "Who founded Facebook?", a: "Mark Zuckerberg", options: ["Steve Jobs", "Bill Gates", "Elon Musk", "Mark Zuckerberg"] },
                { q: "What does RAM stand for?", a: "Random Access Memory", options: ["Read Access Memory", "Random Access Memory", "Rapid Access Memory", "Read And Memory"] },
                { q: "What is a printer for?", a: "Printing", options: ["Typing", "Pointing", "Printing", "Calling"] },
                { q: "Who founded Tesla?", a: "Elon Musk", options: ["Steve Jobs", "Bill Gates", "Elon Musk", "Mark Zuckerberg"] },
                { q: "What does WiFi stand for?", a: "Wireless Fidelity", options: ["Wireless Fidelity", "Wide Fidelity", "Wireless Field", "Wide Field"] },
                { q: "What is a speaker for?", a: "Sound", options: ["Typing", "Sound", "Printing", "Calling"] },
                { q: "Who founded Amazon?", a: "Jeff Bezos", options: ["Steve Jobs", "Jeff Bezos", "Elon Musk", "Mark Zuckerberg"] },
                { q: "What does GPS stand for?", a: "Global Positioning System", options: ["Global Position System", "Global Positioning System", "Global Point System", "Global Position Service"] },
                { q: "What is a webcam for?", a: "Video", options: ["Typing", "Video", "Printing", "Calling"] },
                { q: "Who founded Twitter?", a: "Jack Dorsey", options: ["Steve Jobs", "Jack Dorsey", "Elon Musk", "Mark Zuckerberg"] },
                { q: "What does PDF stand for?", a: "Portable Document Format", options: ["Personal Document Format", "Portable Document Format", "Public Document Format", "Private Document Format"] },
                { q: "What is a router for?", a: "Internet", options: ["Typing", "Internet", "Printing", "Calling"] },
                { q: "Who founded YouTube?", a: "Three people", options: ["One person", "Three people", "Two people", "Four people"] },
                { q: "What does URL stand for?", a: "Uniform Resource Locator", options: ["Universal Resource Locator", "Uniform Resource Locator", "United Resource Locator", "Uniform Resource Link"] },
                { q: "What is a hard drive for?", a: "Storage", options: ["Typing", "Storage", "Printing", "Calling"] },
                { q: "Who founded Netflix?", a: "Reed Hastings", options: ["Steve Jobs", "Reed Hastings", "Elon Musk", "Mark Zuckerberg"] },
                { q: "What does OS stand for?", a: "Operating System", options: ["Open System", "Operating System", "Online System", "Offline System"] },
                { q: "What is a battery for?", a: "Power", options: ["Typing", "Power", "Printing", "Calling"] },
                { q: "Who founded PayPal?", a: "Elon Musk", options: ["Steve Jobs", "Elon Musk", "Bill Gates", "Mark Zuckerberg"] },
                { q: "What does AI stand for?", a: "Artificial Intelligence", options: ["Automatic Intelligence", "Artificial Intelligence", "Advanced Intelligence", "Automated Intelligence"] },
                { q: "What is a charger for?", a: "Charging", options: ["Typing", "Charging", "Printing", "Calling"] },
                { q: "Who founded SpaceX?", a: "Elon Musk", options: ["Steve Jobs", "Elon Musk", "Bill Gates", "Mark Zuckerberg"] },
                { q: "What does VR stand for?", a: "Virtual Reality", options: ["Video Reality", "Virtual Reality", "Visual Reality", "Visible Reality"] },
                { q: "What is a touchscreen?", a: "Touch display", options: ["Keyboard", "Touch display", "Mouse", "Printer"] },
                { q: "Who founded Instagram?", a: "Kevin Systrom", options: ["Steve Jobs", "Kevin Systrom", "Elon Musk", "Mark Zuckerberg"] },
                { q: "What does 4G stand for?", a: "Fourth Generation", options: ["Four Gigabytes", "Fourth Generation", "Four Games", "Fourth Group"] },
                { q: "What is Bluetooth for?", a: "Wireless connection", options: ["Typing", "Wireless connection", "Printing", "Calling"] },
                { q: "Who founded WhatsApp?", a: "Jan Koum", options: ["Steve Jobs", "Jan Koum", "Elon Musk", "Mark Zuckerberg"] },
                { q: "What does SSD stand for?", a: "Solid State Drive", options: ["Super State Drive", "Solid State Drive", "System State Drive", "Storage State Drive"] },
                { q: "What is a tablet?", a: "Touch computer", options: ["Keyboard", "Touch computer", "Mouse", "Printer"] },
                { q: "Who founded Snapchat?", a: "Evan Spiegel", options: ["Steve Jobs", "Evan Spiegel", "Elon Musk", "Mark Zuckerberg"] },
                { q: "What does LED stand for?", a: "Light Emitting Diode", options: ["Light Energy Diode", "Light Emitting Diode", "Light Electric Diode", "Light Emission Diode"] },
                { q: "What is a smartwatch?", a: "Wearable computer", options: ["Keyboard", "Wearable computer", "Mouse", "Printer"] },
                { q: "Who founded TikTok?", a: "Zhang Yiming", options: ["Steve Jobs", "Zhang Yiming", "Elon Musk", "Mark Zuckerberg"] },
                { q: "What does HD stand for?", a: "High Definition", options: ["High Display", "High Definition", "High Digital", "High Data"] },
                { q: "What is a drone?", a: "Flying robot", options: ["Keyboard", "Flying robot", "Mouse", "Printer"] },
                { q: "Who founded LinkedIn?", a: "Reid Hoffman", options: ["Steve Jobs", "Reid Hoffman", "Elon Musk", "Mark Zuckerberg"] },
                { q: "What does MP3 stand for?", a: "MPEG Audio Layer 3", options: ["Music Player 3", "MPEG Audio Layer 3", "Media Player 3", "Music Protocol 3"] },
                { q: "What is a laptop?", a: "Portable computer", options: ["Keyboard", "Portable computer", "Mouse", "Printer"] }
            ],
            Geography: [
                { q: "What is the capital of France?", a: "Paris", options: ["London", "Paris", "Berlin", "Rome"] },
                { q: "Which continent is Egypt in?", a: "Africa", options: ["Asia", "Africa", "Europe", "America"] },
                { q: "What is the tallest mountain?", a: "Everest", options: ["K2", "Everest", "Kilimanjaro", "Alps"] },
                { q: "Which ocean is the largest?", a: "Pacific", options: ["Atlantic", "Pacific", "Indian", "Arctic"] },
                { q: "What is the capital of Japan?", a: "Tokyo", options: ["Beijing", "Tokyo", "Seoul", "Bangkok"] },
                { q: "Which country has pyramids?", a: "Egypt", options: ["Mexico", "Egypt", "India", "China"] },
                { q: "What is the longest river?", a: "Nile", options: ["Amazon", "Nile", "Yangtze", "Mississippi"] },
                { q: "Which continent is Australia in?", a: "Oceania", options: ["Asia", "Oceania", "Africa", "Europe"] },
                { q: "What is the capital of Italy?", a: "Rome", options: ["Paris", "Rome", "Madrid", "Athens"] },
                { q: "Which country is the largest?", a: "Russia", options: ["Canada", "Russia", "China", "USA"] },
                { q: "What is the capital of Spain?", a: "Madrid", options: ["Barcelona", "Madrid", "Seville", "Valencia"] },
                { q: "Which continent is Brazil in?", a: "South America", options: ["North America", "South America", "Africa", "Asia"] },
                { q: "What is the capital of China?", a: "Beijing", options: ["Shanghai", "Beijing", "Tokyo", "Seoul"] },
                { q: "Which ocean is coldest?", a: "Arctic", options: ["Pacific", "Arctic", "Atlantic", "Indian"] },
                { q: "What is the capital of UK?", a: "London", options: ["Paris", "London", "Berlin", "Rome"] },
                { q: "Which desert is largest?", a: "Sahara", options: ["Gobi", "Sahara", "Arabian", "Kalahari"] },
                { q: "What is the capital of USA?", a: "Washington DC", options: ["New York", "Washington DC", "LA", "Chicago"] },
                { q: "Which continent is India in?", a: "Asia", options: ["Africa", "Asia", "Europe", "Oceania"] },
                { q: "What is the capital of Germany?", a: "Berlin", options: ["Munich", "Berlin", "Hamburg", "Frankfurt"] },
                { q: "Which river is in Egypt?", a: "Nile", options: ["Amazon", "Nile", "Ganges", "Yangtze"] },
                { q: "What is the capital of Canada?", a: "Ottawa", options: ["Toronto", "Ottawa", "Montreal", "Vancouver"] },
                { q: "Which mountain is in Nepal?", a: "Everest", options: ["K2", "Everest", "Alps", "Andes"] },
                { q: "What is the capital of Russia?", a: "Moscow", options: ["St Petersburg", "Moscow", "Kiev", "Minsk"] },
                { q: "Which sea is the saltiest?", a: "Dead Sea", options: ["Red Sea", "Dead Sea", "Black Sea", "Baltic Sea"] },
                { q: "What is the capital of Australia?", a: "Canberra", options: ["Sydney", "Canberra", "Melbourne", "Perth"] },
                { q: "Which continent is smallest?", a: "Australia", options: ["Europe", "Australia", "Antarctica", "Africa"] },
                { q: "What is the capital of Mexico?", a: "Mexico City", options: ["Cancun", "Mexico City", "Tijuana", "Guadalajara"] },
                { q: "Which waterfall is largest?", a: "Victoria", options: ["Niagara", "Victoria", "Angel", "Iguazu"] },
                { q: "What is the capital of Brazil?", a: "Brasilia", options: ["Rio", "Brasilia", "Sao Paulo", "Salvador"] },
                { q: "Which island is largest?", a: "Greenland", options: ["Madagascar", "Greenland", "Borneo", "Iceland"] },
                { q: "What is the capital of India?", a: "New Delhi", options: ["Mumbai", "New Delhi", "Kolkata", "Chennai"] },
                { q: "Which lake is largest?", a: "Caspian", options: ["Superior", "Caspian", "Victoria", "Huron"] },
                { q: "What is the capital of Greece?", a: "Athens", options: ["Sparta", "Athens", "Crete", "Rhodes"] },
                { q: "Which volcano is famous?", a: "Vesuvius", options: ["Etna", "Vesuvius", "Fuji", "Krakatoa"] },
                { q: "What is the capital of Egypt?", a: "Cairo", options: ["Alexandria", "Cairo", "Luxor", "Aswan"] },
                { q: "Which canyon is deepest?", a: "Grand Canyon", options: ["Fish River", "Grand Canyon", "Copper", "Colca"] },
                { q: "What is the capital of Turkey?", a: "Ankara", options: ["Istanbul", "Ankara", "Izmir", "Antalya"] },
                { q: "Which forest is largest?", a: "Amazon", options: ["Congo", "Amazon", "Taiga", "Daintree"] },
                { q: "What is the capital of Argentina?", a: "Buenos Aires", options: ["Cordoba", "Buenos Aires", "Rosario", "Mendoza"] },
                { q: "Which peninsula is largest?", a: "Arabian", options: ["Indian", "Arabian", "Iberian", "Korean"] },
                { q: "What is the capital of Thailand?", a: "Bangkok", options: ["Phuket", "Bangkok", "Pattaya", "Chiang Mai"] },
                { q: "Which strait is famous?", a: "Gibraltar", options: ["Bering", "Gibraltar", "Hormuz", "Malacca"] },
                { q: "What is the capital of Poland?", a: "Warsaw", options: ["Krakow", "Warsaw", "Gdansk", "Wroclaw"] },
                { q: "Which bay is largest?", a: "Bengal", options: ["Hudson", "Bengal", "Biscay", "Fundy"] },
                { q: "What is the capital of Sweden?", a: "Stockholm", options: ["Gothenburg", "Stockholm", "Malmo", "Uppsala"] },
                { q: "Which gulf is famous?", a: "Persian", options: ["Mexico", "Persian", "Guinea", "Alaska"] },
                { q: "What is the capital of Norway?", a: "Oslo", options: ["Bergen", "Oslo", "Trondheim", "Stavanger"] },
                { q: "Which cape is famous?", a: "Good Hope", options: ["Horn", "Good Hope", "Cod", "Canaveral"] },
                { q: "What is the capital of Portugal?", a: "Lisbon", options: ["Porto", "Lisbon", "Faro", "Coimbra"] },
                { q: "Which channel is famous?", a: "English", options: ["Panama", "English", "Suez", "Mozambique"] }
            ],
            F1: [
                { q: "How many wheels on F1 car?", a: "4", options: ["2", "4", "6", "8"] },
                { q: "What color is Ferrari?", a: "Red", options: ["Blue", "Red", "Green", "Yellow"] },
                { q: "How many drivers in race?", a: "20", options: ["10", "20", "30", "40"] },
                { q: "What is fastest part of car?", a: "Engine", options: ["Wheels", "Engine", "Wings", "Seat"] },
                { q: "Where is Monaco race?", a: "Monaco", options: ["France", "Monaco", "Italy", "Spain"] },
                { q: "What do drivers wear?", a: "Helmet", options: ["Hat", "Helmet", "Cap", "Crown"] },
                { q: "How many laps in race?", a: "Varies", options: ["10", "Varies", "100", "200"] },
                { q: "What is pit stop?", a: "Quick service", options: ["Parking", "Quick service", "Finish", "Start"] },
                { q: "Who drives the car?", a: "Driver", options: ["Mechanic", "Driver", "Engineer", "Manager"] },
                { q: "What is pole position?", a: "First place", options: ["Last place", "First place", "Middle", "Finish"] },
                { q: "How many teams in F1?", a: "10", options: ["5", "10", "15", "20"] },
                { q: "What is DRS?", a: "Speed boost", options: ["Brake", "Speed boost", "Turn", "Stop"] },
                { q: "Where is British GP?", a: "Silverstone", options: ["Monaco", "Silverstone", "Monza", "Spa"] },
                { q: "What are tires made of?", a: "Rubber", options: ["Plastic", "Rubber", "Metal", "Wood"] },
                { q: "How long is F1 season?", a: "Many months", options: ["1 month", "Many months", "1 week", "1 year"] },
                { q: "What is fastest speed?", a: "Very fast", options: ["Slow", "Very fast", "Medium", "Walking"] },
                { q: "Who wins championship?", a: "Best driver", options: ["Tallest", "Best driver", "Oldest", "Youngest"] },
                { q: "What is safety car?", a: "Slow car", options: ["Fast car", "Slow car", "Big car", "Small car"] },
                { q: "How many points for win?", a: "25", options: ["10", "25", "50", "100"] },
                { q: "What is qualifying?", a: "Time trial", options: ["Race", "Time trial", "Practice", "Finish"] },
                { q: "Where is Italian GP?", a: "Monza", options: ["Monaco", "Silverstone", "Monza", "Spa"] },
                { q: "What is fastest lap?", a: "Best time", options: ["Slowest", "Best time", "First", "Last"] },
                { q: "How many races per year?", a: "About 20", options: ["5", "About 20", "50", "100"] },
                { q: "What is grid?", a: "Starting positions", options: ["Finish", "Starting positions", "Pit", "Track"] },
                { q: "Where is Belgian GP?", a: "Spa", options: ["Monaco", "Silverstone", "Monza", "Spa"] },
                { q: "What is slipstream?", a: "Following close", options: ["Leading", "Following close", "Stopping", "Turning"] },
                { q: "How many practice sessions?", a: "3", options: ["1", "3", "5", "10"] },
                { q: "What is podium?", a: "Top 3", options: ["Start", "Top 3", "Pit", "Garage"] },
                { q: "Where is Spanish GP?", a: "Barcelona", options: ["Madrid", "Barcelona", "Seville", "Valencia"] },
                { q: "What is overtake?", a: "Pass car", options: ["Stop", "Pass car", "Crash", "Park"] },
                { q: "How many mechanics per team?", a: "Many", options: ["1", "Many", "None", "2"] },
                { q: "What is chicane?", a: "Sharp turns", options: ["Straight", "Sharp turns", "Hill", "Bridge"] },
                { q: "Where is Canadian GP?", a: "Montreal", options: ["Toronto", "Montreal", "Vancouver", "Ottawa"] },
                { q: "What is undercut?", a: "Pit strategy", options: ["Crash", "Pit strategy", "Overtake", "Finish"] },
                { q: "How many engines per season?", a: "Limited", options: ["Unlimited", "Limited", "1", "100"] },
                { q: "What is formation lap?", a: "Warm up", options: ["Race", "Warm up", "Finish", "Practice"] },
                { q: "Where is Japanese GP?", a: "Suzuka", options: ["Tokyo", "Suzuka", "Osaka", "Kyoto"] },
                { q: "What is blue flag?", a: "Move over", options: ["Stop", "Move over", "Go fast", "Finish"] },
                { q: "How many gears in F1 car?", a: "8", options: ["4", "8", "12", "16"] },
                { q: "What is parc ferme?", a: "Car storage", options: ["Race", "Car storage", "Pit", "Track"] },
                { q: "Where is Singapore GP?", a: "Singapore", options: ["Malaysia", "Singapore", "Thailand", "Vietnam"] },
                { q: "What is yellow flag?", a: "Danger", options: ["Go", "Danger", "Stop", "Finish"] },
                { q: "How many pit crew members?", a: "About 20", options: ["5", "About 20", "50", "100"] },
                { q: "What is red flag?", a: "Stop race", options: ["Start", "Stop race", "Go fast", "Slow down"] },
                { q: "Where is Abu Dhabi GP?", a: "Yas Marina", options: ["Dubai", "Yas Marina", "Doha", "Bahrain"] },
                { q: "What is green flag?", a: "Go racing", options: ["Stop", "Go racing", "Slow", "Finish"] },
                { q: "How many championships?", a: "Many years", options: ["1", "Many years", "None", "100"] },
                { q: "What is black flag?", a: "Disqualified", options: ["Winner", "Disqualified", "Fast", "Slow"] },
                { q: "Where is US GP?", a: "Austin", options: ["New York", "Austin", "LA", "Miami"] },
                { q: "What is checkered flag?", a: "Finish", options: ["Start", "Finish", "Stop", "Slow"] }
            ],
            Countries: [
                { q: "What is capital of France?", a: "Paris", options: ["London", "Paris", "Berlin", "Rome"] },
                { q: "What is capital of Italy?", a: "Rome", options: ["Paris", "Rome", "Madrid", "Athens"] },
                { q: "What is capital of Spain?", a: "Madrid", options: ["Barcelona", "Madrid", "Seville", "Valencia"] },
                { q: "What is capital of Germany?", a: "Berlin", options: ["Munich", "Berlin", "Hamburg", "Frankfurt"] },
                { q: "What is capital of UK?", a: "London", options: ["Paris", "London", "Berlin", "Rome"] },
                { q: "What is capital of Japan?", a: "Tokyo", options: ["Beijing", "Tokyo", "Seoul", "Bangkok"] },
                { q: "What is capital of China?", a: "Beijing", options: ["Shanghai", "Beijing", "Tokyo", "Seoul"] },
                { q: "What is capital of India?", a: "New Delhi", options: ["Mumbai", "New Delhi", "Kolkata", "Chennai"] },
                { q: "What is capital of USA?", a: "Washington DC", options: ["New York", "Washington DC", "LA", "Chicago"] },
                { q: "What is capital of Canada?", a: "Ottawa", options: ["Toronto", "Ottawa", "Montreal", "Vancouver"] },
                { q: "What is capital of Australia?", a: "Canberra", options: ["Sydney", "Canberra", "Melbourne", "Perth"] },
                { q: "What is capital of Brazil?", a: "Brasilia", options: ["Rio", "Brasilia", "Sao Paulo", "Salvador"] },
                { q: "What is capital of Russia?", a: "Moscow", options: ["St Petersburg", "Moscow", "Kiev", "Minsk"] },
                { q: "What is capital of Mexico?", a: "Mexico City", options: ["Cancun", "Mexico City", "Tijuana", "Guadalajara"] },
                { q: "What is capital of Egypt?", a: "Cairo", options: ["Alexandria", "Cairo", "Luxor", "Aswan"] },
                { q: "What is capital of Greece?", a: "Athens", options: ["Sparta", "Athens", "Crete", "Rhodes"] },
                { q: "What is capital of Turkey?", a: "Ankara", options: ["Istanbul", "Ankara", "Izmir", "Antalya"] },
                { q: "What is capital of Argentina?", a: "Buenos Aires", options: ["Cordoba", "Buenos Aires", "Rosario", "Mendoza"] },
                { q: "What is capital of Thailand?", a: "Bangkok", options: ["Phuket", "Bangkok", "Pattaya", "Chiang Mai"] },
                { q: "What is capital of Poland?", a: "Warsaw", options: ["Krakow", "Warsaw", "Gdansk", "Wroclaw"] },
                { q: "What is capital of Sweden?", a: "Stockholm", options: ["Gothenburg", "Stockholm", "Malmo", "Uppsala"] },
                { q: "What is capital of Norway?", a: "Oslo", options: ["Bergen", "Oslo", "Trondheim", "Stavanger"] },
                { q: "What is capital of Portugal?", a: "Lisbon", options: ["Porto", "Lisbon", "Faro", "Coimbra"] },
                { q: "What is capital of Netherlands?", a: "Amsterdam", options: ["Rotterdam", "Amsterdam", "Hague", "Utrecht"] },
                { q: "What is capital of Belgium?", a: "Brussels", options: ["Antwerp", "Brussels", "Bruges", "Ghent"] },
                { q: "What is capital of Switzerland?", a: "Bern", options: ["Zurich", "Bern", "Geneva", "Basel"] },
                { q: "What is capital of Austria?", a: "Vienna", options: ["Salzburg", "Vienna", "Innsbruck", "Graz"] },
                { q: "What is capital of Denmark?", a: "Copenhagen", options: ["Aarhus", "Copenhagen", "Odense", "Aalborg"] },
                { q: "What is capital of Finland?", a: "Helsinki", options: ["Tampere", "Helsinki", "Turku", "Oulu"] },
                { q: "What is capital of Ireland?", a: "Dublin", options: ["Cork", "Dublin", "Galway", "Limerick"] },
                { q: "What is capital of Scotland?", a: "Edinburgh", options: ["Glasgow", "Edinburgh", "Aberdeen", "Dundee"] },
                { q: "What is capital of Wales?", a: "Cardiff", options: ["Swansea", "Cardiff", "Newport", "Bangor"] },
                { q: "What is capital of New Zealand?", a: "Wellington", options: ["Auckland", "Wellington", "Christchurch", "Hamilton"] },
                { q: "What is capital of South Africa?", a: "Pretoria", options: ["Cape Town", "Pretoria", "Johannesburg", "Durban"] },
                { q: "What is capital of Kenya?", a: "Nairobi", options: ["Mombasa", "Nairobi", "Kisumu", "Nakuru"] },
                { q: "What is capital of Nigeria?", a: "Abuja", options: ["Lagos", "Abuja", "Kano", "Ibadan"] },
                { q: "What is capital of Morocco?", a: "Rabat", options: ["Casablanca", "Rabat", "Marrakech", "Fez"] },
                { q: "What is capital of Algeria?", a: "Algiers", options: ["Oran", "Algiers", "Constantine", "Annaba"] },
                { q: "What is capital of Tunisia?", a: "Tunis", options: ["Sfax", "Tunis", "Sousse", "Kairouan"] },
                { q: "What is capital of Libya?", a: "Tripoli", options: ["Benghazi", "Tripoli", "Misrata", "Tobruk"] },
                { q: "What is capital of Sudan?", a: "Khartoum", options: ["Omdurman", "Khartoum", "Port Sudan", "Kassala"] },
                { q: "What is capital of Ethiopia?", a: "Addis Ababa", options: ["Dire Dawa", "Addis Ababa", "Mekelle", "Gondar"] },
                { q: "What is capital of Ghana?", a: "Accra", options: ["Kumasi", "Accra", "Tamale", "Sekondi"] },
                { q: "What is capital of Senegal?", a: "Dakar", options: ["Thies", "Dakar", "Kaolack", "Saint-Louis"] },
                { q: "What is capital of Tanzania?", a: "Dodoma", options: ["Dar es Salaam", "Dodoma", "Mwanza", "Arusha"] },
                { q: "What is capital of Uganda?", a: "Kampala", options: ["Entebbe", "Kampala", "Gulu", "Mbarara"] },
                { q: "What is capital of Zimbabwe?", a: "Harare", options: ["Bulawayo", "Harare", "Mutare", "Gweru"] },
                { q: "What is capital of Zambia?", a: "Lusaka", options: ["Kitwe", "Lusaka", "Ndola", "Kabwe"] },
                { q: "What is capital of Botswana?", a: "Gaborone", options: ["Francistown", "Gaborone", "Maun", "Kasane"] },
                { q: "What is capital of Namibia?", a: "Windhoek", options: ["Swakopmund", "Windhoek", "Walvis Bay", "Oshakati"] }
            ],
            Science: [
                { q: "What do plants need?", a: "Sunlight", options: ["Darkness", "Sunlight", "Ice", "Fire"] },
                { q: "How many legs does spider have?", a: "8", options: ["6", "8", "4", "10"] },
                { q: "What is water made of?", a: "H2O", options: ["CO2", "H2O", "O2", "N2"] },
                { q: "What do bees make?", a: "Honey", options: ["Milk", "Honey", "Butter", "Cheese"] },
                { q: "What is hottest planet?", a: "Venus", options: ["Mercury", "Venus", "Mars", "Earth"] },
                { q: "What gas do we breathe?", a: "Oxygen", options: ["Carbon", "Oxygen", "Nitrogen", "Helium"] },
                { q: "How many bones in body?", a: "206", options: ["150", "206", "300", "100"] },
                { q: "What is fastest animal?", a: "Cheetah", options: ["Lion", "Cheetah", "Tiger", "Horse"] },
                { q: "What is center of solar system?", a: "Sun", options: ["Earth", "Sun", "Moon", "Mars"] },
                { q: "What do caterpillars become?", a: "Butterflies", options: ["Birds", "Butterflies", "Bees", "Beetles"] },
                { q: "What is largest mammal?", a: "Blue Whale", options: ["Elephant", "Blue Whale", "Giraffe", "Shark"] },
                { q: "What season after winter?", a: "Spring", options: ["Summer", "Spring", "Fall", "Autumn"] },
                { q: "What do fish use to breathe?", a: "Gills", options: ["Lungs", "Gills", "Nose", "Mouth"] },
                { q: "How many days in year?", a: "365", options: ["360", "365", "300", "400"] },
                { q: "What is smallest planet?", a: "Mercury", options: ["Mars", "Mercury", "Venus", "Pluto"] },
                { q: "What do plants produce?", a: "Oxygen", options: ["Carbon", "Oxygen", "Nitrogen", "Helium"] },
                { q: "What is largest organ?", a: "Skin", options: ["Heart", "Skin", "Brain", "Liver"] },
                { q: "What causes rain?", a: "Clouds", options: ["Wind", "Clouds", "Sun", "Moon"] },
                { q: "What is hardest substance?", a: "Diamond", options: ["Gold", "Diamond", "Iron", "Silver"] },
                { q: "How many hearts does octopus have?", a: "3", options: ["1", "3", "2", "4"] },
                { q: "What is closest star?", a: "Sun", options: ["Moon", "Sun", "Mars", "Venus"] },
                { q: "What do tadpoles become?", a: "Frogs", options: ["Fish", "Frogs", "Snakes", "Lizards"] },
                { q: "What is tallest animal?", a: "Giraffe", options: ["Elephant", "Giraffe", "Horse", "Bear"] },
                { q: "What do bees collect?", a: "Honey", options: ["Nectar", "Pollen", "Wax", "Honey"] },
                { q: "What is Earth made of?", a: "Rock", options: ["Rock", "Water", "Air", "Fire"] },
                { q: "What do we use to breathe?", a: "Lungs", options: ["Lungs", "Gills", "Skin", "Mouth"] },
                { q: "What is the moon?", a: "Satellite", options: ["Planet", "Star", "Satellite", "Comet"] },
                { q: "What makes plants green?", a: "Chlorophyll", options: ["Water", "Chlorophyll", "Sun", "Soil"] },
                { q: "What do birds have?", a: "Feathers", options: ["Scales", "Feathers", "Fur", "Skin"] },
                { q: "What is ice?", a: "Frozen water", options: ["Hot water", "Frozen water", "Steam", "Rain"] },
                { q: "What do fish have?", a: "Scales", options: ["Feathers", "Scales", "Fur", "Skin"] },
                { q: "What causes thunder?", a: "Lightning", options: ["Rain", "Lightning", "Wind", "Clouds"] },
                { q: "What do humans need?", a: "Food", options: ["Food", "Gold", "Cars", "TV"] },
                { q: "What gives light?", a: "Sun", options: ["Moon", "Sun", "Stars", "Planets"] },
                { q: "What animal barks?", a: "Dog", options: ["Cat", "Dog", "Cow", "Bird"] },
                { q: "What do trees give us?", a: "Oxygen", options: ["Carbon", "Oxygen", "Nitrogen", "Helium"] },
                { q: "What do we use to hear?", a: "Ears", options: ["Eyes", "Ears", "Nose", "Mouth"] },
                { q: "What is study of plants?", a: "Botany", options: ["Zoology", "Botany", "Biology", "Geology"] },
                { q: "What is study of animals?", a: "Zoology", options: ["Botany", "Zoology", "Biology", "Geology"] },
                { q: "What do butterflies come from?", a: "Caterpillars", options: ["Eggs", "Caterpillars", "Pupae", "Worms"] },
                { q: "What pulls things down?", a: "Gravity", options: ["Wind", "Gravity", "Water", "Magnet"] },
                { q: "What layer do we live on?", a: "Crust", options: ["Core", "Crust", "Mantle", "Atmosphere"] },
                { q: "What makes plant food?", a: "Photosynthesis", options: ["Respiration", "Photosynthesis", "Digestion", "Circulation"] },
                { q: "What is main gas in air?", a: "Nitrogen", options: ["Oxygen", "Nitrogen", "Carbon", "Hydrogen"] },
                { q: "What measures heat?", a: "Thermometer", options: ["Barometer", "Thermometer", "Speedometer", "Clock"] },
                { q: "What do we breathe out?", a: "Carbon dioxide", options: ["Oxygen", "Carbon dioxide", "Nitrogen", "Helium"] },
                { q: "What animal says 'meow'?", a: "Cat", options: ["Dog", "Cat", "Cow", "Bird"] },
                { q: "What animal says 'woof'?", a: "Dog", options: ["Cat", "Dog", "Cow", "Bird"] },
                { q: "What animal says 'moo'?", a: "Cow", options: ["Dog", "Cat", "Cow", "Bird"] }
            ]
        };

        const categoryEmojis = {
            Maths: "🔢", World: "🌍", History: "📜", Tech: "💻",
            Geography: "🗺️", F1: "🏎️", Countries: "🏳️", Science: "🔬"
        };

        const categoryColors = {
            Maths: "from-blue-500 to-cyan-500",
            World: "from-green-500 to-teal-500",
            History: "from-amber-500 to-orange-500",
            Tech: "from-purple-500 to-violet-500",
            Geography: "from-emerald-500 to-green-500",
            F1: "from-red-500 to-rose-500",
            Countries: "from-indigo-500 to-blue-500",
            Science: "from-pink-500 to-fuchsia-500"
        };

        // Primeira pista (original)
        const PATH1 = [
            { x: 0, y: 4 }, { x: 1, y: 4 }, { x: 2, y: 4 }, { x: 3, y: 4 },
            { x: 3, y: 3 }, { x: 3, y: 2 }, { x: 4, y: 2 }, { x: 5, y: 2 },
            { x: 5, y: 3 }, { x: 5, y: 4 }, { x: 5, y: 5 }, { x: 5, y: 6 },
            { x: 6, y: 6 }, { x: 7, y: 6 }, { x: 8, y: 6 }, { x: 8, y: 5 },
            { x: 8, y: 4 }, { x: 8, y: 3 }, { x: 9, y: 3 }, { x: 10, y: 3 },
            { x: 11, y: 3 }, { x: 12, y: 3 }, { x: 13, y: 3 }, { x: 14, y: 3 }
        ];

        // Segunda pista (pista de corrida - disponível após wave 50)
        const PATH2 = [
            // Começo reto
            { x: 0, y: 2 }, { x: 1, y: 2 }, { x: 2, y: 2 }, { x: 3, y: 2 },
            // Primeira curva
            { x: 3, y: 3 }, { x: 3, y: 4 }, { x: 3, y: 5 }, { x: 3, y: 6 },
            // Reto na parte inferior
            { x: 4, y: 6 }, { x: 5, y: 6 }, { x: 6, y: 6 }, { x: 7, y: 6 },
            { x: 8, y: 6 }, { x: 9, y: 6 }, { x: 10, y: 6 },
            // Curva para cima
            { x: 10, y: 5 }, { x: 10, y: 4 }, { x: 10, y: 3 }, { x: 10, y: 2 },
            // Reto no meio
            { x: 11, y: 2 }, { x: 12, y: 2 }, { x: 13, y: 2 },
            // Curva final
            { x: 13, y: 3 }, { x: 13, y: 4 }, { x: 13, y: 5 }, { x: 13, y: 6 },
            { x: 14, y: 6 }
        ];

        const gameState = {
            view: 'playerSetup',
            coins: 50,
            points: 0,
            currentWave: 0,
            enemiesKilled: 0,
            lives: 3,
            maxLives: 3,
            playerName: '',
            playerAge: '',
            playerPassword: '',
            isReturningPlayer: false,
            quiz: { 
                category: null, 
                questions: [], 
                index: 0, 
                score: 0,
                answeredCategories: [],
                waitingForNext: false,
                currentShuffledOptions: [],
                currentCorrectIndex: -1
            },
            defense: { 
                towers: {}, 
                blocks: [], 
                lasers: [],
                destroyerPrices: {}
            },
            isPaused: false,
            waveInProgress: false,
            currentTrack: 1,
            lastSave: null,
            dbLoaded: false
        };

// Funções de banco de dados
async function loadLeaderboard() {
    try {
        const { data, error } = await supa
            .from('leaderboard')
            .select('*')
            .order('points', { ascending: false })
            .limit(10);

        if (error) throw error;
        return data || [];
    } catch (error) {
        console.error('Error loading leaderboard:', error);
        return [];
    }
}

async function saveToLeaderboard() {
    try {
        const entry = {
            name: gameState.playerName,
            age: parseInt(gameState.playerAge) || 0,
            points: gameState.points,
            wave: gameState.currentWave,
            kills: gameState.enemiesKilled,
            date: new Date().toISOString()
        };

        const { data: existing } = await supa
            .from('leaderboard')
            .select('*')
            .eq('name', gameState.playerName)
            .maybeSingle();

        if (existing) {
            if (entry.points > existing.points) {
                const { error } = await supa
                    .from('leaderboard')
                    .update(entry)
                    .eq('id', existing.id);

                if (error) throw error;
            }
        } else {
            const { error } = await supa
                .from('leaderboard')
                .insert([entry]);

            if (error) throw error;
        }

        await updatePlayerDatabase();

        const { data: leaderboard } = await supa
            .from('leaderboard')
            .select('*')
            .order('points', { ascending: false });

        if (leaderboard) {
            return leaderboard.findIndex(e => e.name === entry.name) + 1;
        }
        return 0;
    } catch (error) {
        console.error('Error saving to leaderboard:', error);
        return 0;
    }
}

async function updatePlayerDatabase() {
    try {
        const playerData = {
            name: gameState.playerName,
            age: parseInt(gameState.playerAge) || 0,
            password: gameState.playerPassword,
            highscore: gameState.points,
            lastplayed: new Date().toISOString()
        };

        const { data: existing } = await supa
            .from('players')
            .select('*')
            .eq('name', gameState.playerName)
            .maybeSingle();

        if (existing) {
            if (playerData.highscore > existing.highscore) {
                const { error } = await supa
                    .from('players')
                    .update({
                        highscore: playerData.highscore,
                        lastplayed: playerData.lastplayed
                    })
                    .eq('id', existing.id);

                if (error) throw error;
            }
        } else {
            const { error } = await supa
                .from('players')
                .insert([playerData]);

            if (error) throw error;
        }
    } catch (error) {
        console.error('Error updating player database:', error);
    }
}

async function findExistingPlayer(name) {
    try {
        const { data } = await supa
            .from('players')
            .select('*')
            .eq('name', name)
            .maybeSingle();

        return data || null;
    } catch (error) {
        console.error('Error finding player:', error);
        return null;
    }
}

async function verifyPlayerPassword(name, password) {
    try {
        const { data } = await supa
            .from('players')
            .select('password')
            .eq('name', name)
            .maybeSingle();

        if (!data) return false;
        return data.password === password;
    } catch (error) {
        console.error('Error verifying password:', error);
        return false;
    }
}

async function saveGame() {
    try {
        const saveData = {
            playername: gameState.playerName,
            data: JSON.stringify({
                coins: gameState.coins,
                points: gameState.points,
                currentWave: gameState.currentWave,
                enemiesKilled: gameState.enemiesKilled,
                lives: gameState.lives,
                defense: {
                    towers: gameState.defense.towers,
                    destroyerPrices: gameState.defense.destroyerPrices
                },
                currentTrack: gameState.currentTrack,
                quizAnsweredCategories: gameState.quiz.answeredCategories
            }),
            savedat: new Date().toISOString()
        };

        const { data: existing } = await supa
            .from('saved_games')
            .select('*')
            .eq('playername', gameState.playerName)
            .maybeSingle();

        if (existing) {
            const { error } = await supa
                .from('saved_games')
                .update(saveData)
                .eq('id', existing.id);

            if (error) throw error;
        } else {
            const { error } = await supa
                .from('saved_games')
                .insert([saveData]);

            if (error) throw error;
        }

        gameState.lastSave = saveData.savedat;
        return true;
    } catch (error) {
        console.error('Error saving game:', error);
        return false;
    }
}

async function loadGame() {
    try {
        const { data } = await supa
            .from('saved_games')
            .select('*')
            .eq('playername', gameState.playerName)
            .maybeSingle();

        if (!data) return false;

        const savedData = JSON.parse(data.data);

        gameState.coins = savedData.coins;
        gameState.points = savedData.points;
        gameState.currentWave = savedData.currentWave;
        gameState.enemiesKilled = savedData.enemiesKilled;
        gameState.lives = savedData.lives;
        gameState.defense.towers = savedData.defense.towers || {};
        gameState.defense.destroyerPrices = savedData.defense.destroyerPrices || {};
        gameState.currentTrack = savedData.currentTrack || 1;
        gameState.quiz.answeredCategories = savedData.quizAnsweredCategories || [];
        gameState.lastSave = data.savedat;

        return true;
    } catch (error) {
        console.error('Error loading game:', error);
        return false;
    }
}

async function deleteSave() {
    try {
        const { error } = await supa
            .from('saved_games')
            .delete()
            .eq('playername', gameState.playerName);

        if (error) throw error;
        return true;
    } catch (error) {
        console.error('Error deleting save:', error);
        return false;
    }
}

        // NEW FUNCTION: Handle quiz completion
        function handleQuizCompletion() {
            if (gameState.quiz.category && !gameState.quiz.answeredCategories.includes(gameState.quiz.category)) {
                gameState.quiz.answeredCategories.push(gameState.quiz.category);
            }
            
            const allCategories = Object.keys(QUIZ_QUESTIONS);
            if (gameState.quiz.answeredCategories.length >= allCategories.length) {
                gameState.quiz.answeredCategories = [];
                showNotification("🎉 All categories completed! All categories unlocked again!", 4000);
            }
            
            gameState.view = 'menu';
            gameState.quiz.category = null;
            gameState.quiz.questions = [];
            gameState.quiz.index = 0;
            gameState.quiz.score = 0;
            gameState.quiz.currentShuffledOptions = [];
            gameState.quiz.currentCorrectIndex = -1;
            render();
        }
        
        const $ = (id) => document.getElementById(id);
        const gameContent = $('game-content');
        let canvas = null;
        let ctx = null;
        let gameLoopInterval = null;
        let selectedTowerType = 0;
        let CELL_SIZE = 0;
        const GRID_SIZE = 15;
        let movingTower = null;
        let PATH = PATH1;
        let TOWER_SLOTS = [];
        let blocksSpawnedThisWave = 0;
        let blocksPerWave = 5;
        let nextBlockSpawnTime = 0;
        let lastTime = performance.now();

        function calculateTowerSlots() {
            TOWER_SLOTS = PATH.flatMap(p => [
                { x: p.x + 1, y: p.y }, { x: p.x - 1, y: p.y },
                { x: p.x, y: p.y + 1 }, { x: p.x, y: p.y - 1 }
            ]).filter(s => s.x >= 0 && s.x < GRID_SIZE && s.y >= 0 && s.y < GRID_SIZE && !PATH.some(p => p.x === s.x && p.y === s.y))
              .reduce((acc, current) => {
                  const key = `${current.x},${current.y}`;
                  if (!acc.find(item => item.key === key)) {
                      acc.push({ x: current.x, y: current.y, key: key });
                  }
                  return acc;
              }, []);
        }

        class Block {
            constructor(path, speed = 0.5, health = 30) {
                this.path = path;
                this.pathIndex = 0;
                this.speed = speed;
                this.baseSpeed = speed;
                this.position = { x: path[0].x, y: path[0].y };
                this.health = health;
                this.maxHealth = health;
                this.slowTimer = 0;
            }

            move(delta) {
                if (this.slowTimer > 0) {
                    this.slowTimer -= delta * 1000;
                    if (this.slowTimer <= 0) this.speed = this.baseSpeed;
                }
                if (this.pathIndex >= this.path.length - 1) return false;

                const target = this.path[this.pathIndex + 1];
                let dx = target.x - this.position.x;
                let dy = target.y - this.position.y;
                this.position.x += Math.sign(dx) * this.speed * delta;
                this.position.y += Math.sign(dy) * this.speed * delta;

                if (Math.abs(target.x - this.position.x) < this.speed * delta &&
                    Math.abs(target.y - this.position.y) < this.speed * delta) {
                    this.position.x = target.x;
                    this.position.y = target.y;
                    this.pathIndex++;
                    return (this.pathIndex < this.path.length);
                }
                return true;
            }

            applySlow(amount, duration) {
                this.speed = this.baseSpeed * amount;
                this.slowTimer = duration;
            }
        }

        class Laser {
            constructor(fromX, fromY, toX, toY, color, duration = 100) {
                this.fromX = fromX; this.fromY = fromY;
                this.toX = toX; this.toY = toY;
                this.color = color;
                this.duration = duration;
                this.timeLeft = duration;
            }
            update(delta) {
                this.timeLeft -= delta * 1000;
                return this.timeLeft > 0;
            }
        }

        function showNotification(message, duration = 3000, isError = false) {
            const box = $('notification-box');
            box.textContent = message;
            box.className = `fixed bottom-4 right-4 p-3 text-white rounded-lg shadow-lg ${isError ? 'bg-red-500' : 'bg-green-500'} transition-opacity duration-300 z-50`;
            box.classList.remove('hidden');
            box.style.opacity = '1';
            setTimeout(() => {
                box.style.opacity = '0';
                setTimeout(() => box.classList.add('hidden'), 300);
            }, duration);
        }

        function showModal(title, message, buttons) {
            const modal = $('custom-modal');
            const modalTitle = $('modal-title');
            const modalMessage = $('modal-message');
            const modalButtons = $('modal-buttons');

            modalTitle.textContent = title;
            modalMessage.innerHTML = message;
            modalButtons.innerHTML = buttons.map(btn =>
                `<button onclick="${btn.action}" class="px-4 py-2 ${btn.class} text-white font-semibold rounded-lg transition duration-200 mx-1">${btn.text}</button>`
            ).join('');

            modal.classList.remove('hidden');
        }

        function hideModal() {
            $('custom-modal').classList.add('hidden');
        }

        function getDistance(x1, y1, x2, y2) {
            return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
        }

        function findTargetsInRange(towerX, towerY, range, count = 1) {
            const targets = [];
            for (const block of gameState.defense.blocks) {
                const dist = getDistance(towerX, towerY, block.position.x, block.position.y);
                if (dist <= range) targets.push({ block, dist });
            }
            targets.sort((a, b) => a.dist - b.dist);
            return targets.slice(0, count).map(t => t.block);
        }

        function gameLoop() {
            if (gameState.view !== 'defense' || gameState.isPaused) {
                return;
            }

            const currentTime = performance.now();
            const delta = (currentTime - lastTime) / 1000;
            lastTime = currentTime;

            if (gameState.waveInProgress && blocksSpawnedThisWave < blocksPerWave && Date.now() > nextBlockSpawnTime) {
                const speed = 1 + gameState.currentWave * 0.08;
                const health = 30 + gameState.currentWave * 10;
                gameState.defense.blocks.push(new Block(PATH, speed, health));
                blocksSpawnedThisWave++;
                nextBlockSpawnTime = Date.now() + Math.max(300, 1200 - gameState.currentWave * 30);
            }

            if (gameState.waveInProgress && blocksSpawnedThisWave >= blocksPerWave && gameState.defense.blocks.length === 0) {
                gameState.waveInProgress = false;
                gameState.currentWave++;

                if (gameState.currentWave >= 50 && gameState.currentTrack === 1) {
                    gameState.currentTrack = 2;
                    PATH = PATH2;
                    calculateTowerSlots();
                    showNotification("🏁 RACE TRACK UNLOCKED! New track layout!", 5000);
                }

                if (gameState.currentWave === 25) {
                    showNotification("🎉 DESTROYER TOWER UNLOCKED! Available in shop!", 5000);
                    updateShopUI();
                }

                const btn = $('start-wave-btn');
                if (btn) {
                    btn.textContent = `🚀 Start Wave ${gameState.currentWave + 1}`;
                    btn.disabled = false;
                    btn.classList.remove('opacity-50');
                }

                showNotification(`🎉 Wave ${gameState.currentWave} complete!`, 3000);
                updateStatsUI();
            }

            const now = Date.now();
            const towersToRemove = [];
            
            for (const key in gameState.defense.towers) {
                const tower = gameState.defense.towers[key];
                const towerDef = TOWERS[tower.typeId];
                const [tx, ty] = key.split(',').map(Number);

                if (towerDef.temporary && tower.placedAt) {
                    const timeElapsed = now - tower.placedAt;
                    const timeLeft = towerDef.duration - timeElapsed;
                    
                    if (timeLeft <= 0) {
                        towersToRemove.push(key);
                        createExplosion(tx, ty);
                        showNotification(`💥 Destroyer tower expired!`, 2000);
                        continue;
                    }
                }

                if (now - tower.lastFired >= towerDef.fireRate) {
                    const targetCount = towerDef.chainTargets || 1;
                    const targets = findTargetsInRange(tx, ty, towerDef.range, targetCount);

                    if (targets.length > 0) {
                        tower.lastFired = now;
                        for (const target of targets) {
                            target.health -= towerDef.damage;
                            if (towerDef.slowEffect) {
                                target.applySlow(towerDef.slowEffect, towerDef.slowDuration || 2000);
                            }
                            gameState.defense.lasers.push(new Laser(
                                tx * CELL_SIZE + CELL_SIZE / 2,
                                ty * CELL_SIZE + CELL_SIZE / 2,
                                target.position.x * CELL_SIZE + CELL_SIZE / 2,
                                target.position.y * CELL_SIZE + CELL_SIZE / 2,
                                towerDef.laserColor, 150
                            ));
                        }
                    }
                }
            }

            towersToRemove.forEach(key => {
                delete gameState.defense.towers[key];
            });

            gameState.defense.lasers = gameState.defense.lasers.filter(laser => laser.update(delta));

            const blocksToRemove = [];
            gameState.defense.blocks.forEach((block, index) => {
                if (block.health <= 0) {
                    blocksToRemove.push(index);
                    gameState.enemiesKilled++;
                    gameState.points += 10;
                    return;
                }
                if (!block.move(delta)) {
                    blocksToRemove.push(index);
                    gameState.lives--;
                    showNotification(`💔 Enemy got through! Lives: ${gameState.lives}`, 1500, true);
                    if (gameState.lives <= 0) {
                        clearInterval(gameLoopInterval);
                        saveToLeaderboard().then(position => {
                            deleteSave();
                            showNotification('💀 GAME OVER!', 3000, true);
                            setTimeout(() => {
                                showModal(
                                    '💀 GAME OVER',
                                    `<div class="text-left">
                                        <p class="mb-2"><strong>Player:</strong> ${gameState.playerName}</p>
                                        <p class="mb-2"><strong>Final Score:</strong> ${gameState.points} points</p>
                                        <p class="mb-2"><strong>Wave Reached:</strong> ${gameState.currentWave}</p>
                                        <p class="mb-2"><strong>Enemies Killed:</strong> ${gameState.enemiesKilled}</p>
                                        <p class="mb-4"><strong>Leaderboard Position:</strong> #${position}</p>
                                        <p class="text-sm text-yellow-400">⚠️ Game progress has been reset</p>
                                    </div>`,
                                    [{ text: '🏠 Back to Menu', action: 'window.resetToMenu()', class: 'bg-indigo-600 hover:bg-indigo-700' }]
                                );
                            }, 3000);
                        });
                        return;
                    }
                }
            });

            [...new Set(blocksToRemove)].sort((a, b) => b - a).forEach(idx => {
                gameState.defense.blocks.splice(idx, 1);
            });

            drawDefenseScene();
            updateStatsUI();
        }

        function createExplosion(x, y) {
            const centerX = x * CELL_SIZE + CELL_SIZE / 2;
            const centerY = y * CELL_SIZE + CELL_SIZE / 2;
            
            for (let i = 0; i < 8; i++) {
                const angle = (i * Math.PI) / 4;
                const distance = CELL_SIZE * 0.8;
                const toX = centerX + Math.cos(angle) * distance;
                const toY = centerY + Math.sin(angle) * distance;
                
                gameState.defense.lasers.push(new Laser(
                    centerX, centerY,
                    toX, toY,
                    '#FF6B00', 500
                ));
            }
        }

        function drawDefenseScene() {
            if (!ctx) return;
            const W = canvas.width, H = canvas.height, CS = CELL_SIZE;

            ctx.fillStyle = '#18181b';
            ctx.fillRect(0, 0, W, H);

            if (gameState.currentTrack === 2) {
                ctx.fillStyle = '#1a1a1a';
                ctx.fillRect(0, 0, W, H);
                
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.setLineDash([10, 10]);
                for (let y = 0; y < GRID_SIZE; y += 2) {
                    ctx.beginPath();
                    ctx.moveTo(0, y * CS + CS/2);
                    ctx.lineTo(W, y * CS + CS/2);
                    ctx.stroke();
                }
                ctx.setLineDash([]);
            }

            TOWER_SLOTS.forEach(s => {
                ctx.fillStyle = gameState.currentTrack === 2 ? '#2d3748' : '#374151';
                ctx.fillRect(s.x * CS + 1, s.y * CS + 1, CS - 2, CS - 2);
            });

            PATH.forEach((p, i) => {
                ctx.fillStyle = gameState.currentTrack === 2 ? '#4a5568' : '#78350f';
                ctx.fillRect(p.x * CS, p.y * CS, CS, CS);
                ctx.fillStyle = gameState.currentTrack === 2 ? '#718096' : '#92400e';
                ctx.font = `${CS * 0.4}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                if (i < PATH.length - 1) {
                    const next = PATH[i + 1];
                    let arrow = '→';
                    if (next.y < p.y) arrow = '↑';
                    else if (next.y > p.y) arrow = '↓';
                    else if (next.x < p.x) arrow = '←';
                    ctx.fillText(arrow, p.x * CS + CS/2, p.y * CS + CS/2);
                }
            });

            ctx.fillStyle = gameState.currentTrack === 2 ? '#38a169' : '#10b981';
            ctx.fillRect(PATH[0].x * CS, PATH[0].y * CS, CS, CS);
            ctx.fillStyle = 'white';
            ctx.font = `bold ${CS * 0.3}px Arial`;
            ctx.fillText('START', PATH[0].x * CS + CS/2, PATH[0].y * CS + CS/2);
            ctx.fillStyle = gameState.currentTrack === 2 ? '#e53e3e' : '#dc2626';
            ctx.fillRect(PATH[PATH.length - 1].x * CS, PATH[PATH.length - 1].y * CS, CS, CS);
            ctx.fillStyle = 'white';
            ctx.fillText('END', PATH[PATH.length - 1].x * CS + CS/2, PATH[PATH.length - 1].y * CS + CS/2);

            for (const key in gameState.defense.towers) {
                const tower = gameState.defense.towers[key];
                const towerDef = TOWERS[tower.typeId];
                const [x, y] = key.split(',').map(Number);
                const centerX = x * CS + CS/2;
                const centerY = y * CS + CS/2;
                const radius = CS * 0.4;

                if (towerDef.temporary && tower.placedAt) {
                    const timeElapsed = Date.now() - tower.placedAt;
                    const timeLeft = towerDef.duration - timeElapsed;
                    const minutes = Math.floor(timeLeft / 60000);
                    const seconds = Math.floor((timeLeft % 60000) / 1000);
                    
                    ctx.fillStyle = '#000000';
                    ctx.fillRect(centerX - 15, centerY - radius - 20, 30, 15);
                    ctx.fillStyle = '#FF6B00';
                    ctx.font = 'bold 10px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText(`${minutes}:${seconds.toString().padStart(2, '0')}`, centerX, centerY - radius - 10);
                }

                ctx.fillStyle = '#1f2937';
                ctx.fillRect(centerX - radius * 0.8, centerY + radius * 0.2, radius * 1.6, radius * 0.6);

                switch(towerDef.id) {
                    case 8:
                        ctx.fillStyle = towerDef.color;
                        ctx.beginPath();
                        ctx.arc(centerX, centerY, radius * 0.8, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillStyle = '#FF6B00';
                        ctx.beginPath();
                        ctx.arc(centerX, centerY, radius * 0.5, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillStyle = '#ffffff';
                        ctx.font = 'bold 10px Arial';
                        ctx.fillText('D', centerX - 3, centerY + 3);
                        break;

                    case 9:
                        ctx.fillStyle = towerDef.color;
                        ctx.beginPath();
                        ctx.moveTo(centerX, centerY - radius);
                        ctx.lineTo(centerX - radius * 0.7, centerY + radius * 0.5);
                        ctx.lineTo(centerX + radius * 0.7, centerY + radius * 0.5);
                        ctx.closePath();
                        ctx.fill();
                        ctx.fillStyle = '#87CEFA';
                        ctx.beginPath();
                        ctx.arc(centerX, centerY - radius * 0.3, radius * 0.3, 0, Math.PI * 2);
                        ctx.fill();
                        break;

                    default:
                        ctx.fillStyle = towerDef.color;
                        ctx.fillRect(centerX - radius * 0.5, centerY - radius * 0.8, radius, radius * 1.2);
                        ctx.fillStyle = '#2d3748';
                        ctx.fillRect(centerX - radius * 0.4, centerY - radius * 0.6, radius * 0.8, radius * 0.2);
                        ctx.fillStyle = towerDef.laserColor;
                        ctx.beginPath();
                        ctx.arc(centerX, centerY - radius * 0.9, radius * 0.3, 0, Math.PI * 2);
                        ctx.fill();
                }

                ctx.strokeStyle = towerDef.color + '33';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(centerX, centerY, towerDef.range * CS, 0, Math.PI * 2);
                ctx.stroke();
            }

            gameState.defense.lasers.forEach(laser => {
                const alpha = laser.timeLeft / laser.duration;
                ctx.strokeStyle = laser.color;
                ctx.lineWidth = 3 * alpha;
                ctx.shadowColor = laser.color;
                ctx.shadowBlur = 10 * alpha;
                ctx.beginPath();
                ctx.moveTo(laser.fromX, laser.fromY);
                ctx.lineTo(laser.toX, laser.toY);
                ctx.stroke();
                ctx.shadowBlur = 0;
            });

            gameState.defense.blocks.forEach(block => {
                const xCenter = block.position.x * CS + CS / 2;
                const yCenter = block.position.y * CS + CS / 2;
                const size = CS * 0.4;
                const healthRatio = block.health / block.maxHealth;

                ctx.fillStyle = 'rgba(0,0,0,0.3)';
                ctx.fillRect(xCenter - size/2 + 2, yCenter + size/2 + 2, size, size * 0.15);

                let bodyColor;
                if (block.slowTimer > 0) bodyColor = '#81D4FA';
                else if (healthRatio > 0.6) bodyColor = '#2d5016';
                else if (healthRatio > 0.3) bodyColor = '#92400e';
                else bodyColor = '#7f1d1d';

                ctx.fillStyle = '#374151';
                ctx.beginPath();
                ctx.arc(xCenter, yCenter - size * 0.3, size * 0.25, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = '#d4a574';
                ctx.beginPath();
                ctx.arc(xCenter, yCenter - size * 0.2, size * 0.2, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = bodyColor;
                ctx.fillRect(xCenter - size * 0.25, yCenter - size * 0.05, size * 0.5, size * 0.5);

                ctx.fillStyle = bodyColor;
                ctx.fillRect(xCenter - size * 0.4, yCenter, size * 0.15, size * 0.35);
                ctx.fillRect(xCenter + size * 0.25, yCenter, size * 0.15, size * 0.35);

                ctx.fillStyle = '#1f2937';
                ctx.fillRect(xCenter - size * 0.2, yCenter + size * 0.4, size * 0.15, size * 0.35);
                ctx.fillRect(xCenter + size * 0.05, yCenter + size * 0.4, size * 0.15, size * 0.35);

                ctx.fillStyle = '#4b5563';
                ctx.fillRect(xCenter + size * 0.25, yCenter + size * 0.1, size * 0.3, size * 0.1);

                const barWidth = CS * 0.6, barHeight = CS * 0.08;
                ctx.fillStyle = '#1f2937';
                ctx.fillRect(xCenter - barWidth/2, yCenter - size * 0.6, barWidth, barHeight);
                ctx.fillStyle = healthRatio > 0.5 ? '#22c55e' : healthRatio > 0.25 ? '#f59e0b' : '#ef4444';
                ctx.fillRect(xCenter - barWidth/2, yCenter - size * 0.6, barWidth * healthRatio, barHeight);
            });
        }

        function updateStatsUI() {
            const stats = $('defense-stats');
            if (!stats) return;

            let heartsDisplay = '';
            for (let i = 0; i < gameState.maxLives; i++) {
                heartsDisplay += i < gameState.lives ? '❤️' : '🖤';
            }

            stats.innerHTML = `
                <div class="px-3 py-2 bg-gray-800/80 rounded-lg shadow-inner text-center">
                    <p class="text-xs text-gray-400">Lives</p>
                    <p class="text-lg font-bold">${heartsDisplay}</p>
                </div>
                <div class="px-3 py-2 bg-gray-800/80 rounded-lg shadow-inner text-center">
                    <p class="text-xs text-gray-400">💰 Coins</p>
                    <p class="text-lg font-bold text-yellow-400">${gameState.coins}</p>
                </div>
                <div class="px-3 py-2 bg-gray-800/80 rounded-lg shadow-inner text-center">
                    <p class="text-xs text-gray-400">⭐ Points</p>
                    <p class="text-lg font-bold text-purple-400">${gameState.points}</p>
                </div>
                <div class="px-3 py-2 bg-gray-800/80 rounded-lg shadow-inner text-center">
                    <p class="text-xs text-gray-400">🌊 Wave</p>
                    <p class="text-lg font-bold text-green-400">${gameState.currentWave + 1}</p>
                </div>
                <div class="px-3 py-2 bg-gray-800/80 rounded-lg shadow-inner text-center">
                    <p class="text-xs text-gray-400">💀 Kills</p>
                    <p class="text-lg font-bold text-red-400">${gameState.enemiesKilled}</p>
                </div>
                <div class="px-3 py-2 bg-gray-800/80 rounded-lg shadow-inner text-center">
                    <p class="text-xs text-gray-400">🏁 Track</p>
                    <p class="text-lg font-bold ${gameState.currentTrack === 2 ? 'text-orange-400' : 'text-blue-400'}">${gameState.currentTrack}</p>
                </div>
            `;
        }

        function updateShopUI() {
            const shop = $('tower-shop');
            if (!shop) return;
            shop.innerHTML = TOWERS.map(tower => {
                const isDestroyer = tower.id === 8;
                const isAvailable = !isDestroyer || gameState.currentWave >= (tower.availableAtWave || 0);
                const isSelected = selectedTowerType === tower.id;
                const isDisabled = !isAvailable;
                const currentPrice = isDestroyer ? 
                    (gameState.defense.destroyerPrices['default'] || tower.cost) : 
                    tower.cost;
                
                return `
                    <button onclick="${isDisabled ? '' : `window.selectTower(${tower.id})`}"
                            class="p-1.5 rounded-lg font-bold text-xs transition duration-150 ${isDisabled ? 'disabled-tower' : ''}
                                    ${isSelected ? 'bg-gray-600' : 'bg-gray-700 hover:bg-gray-600'}"
                            style="border: 2px solid ${tower.color};"
                            title="${tower.description}${isDestroyer ? `\nAvailable at wave ${tower.availableAtWave}` : ''}${isDisabled ? '\n(Locked)' : ''}">
                        <div class="text-xs font-semibold mb-0.5" style="color: ${tower.color}">${tower.name}</div>
                        <div class="text-yellow-400 text-xs">💰 ${currentPrice}</div>
                        <div class="flex justify-between text-xs">
                            <span class="text-red-400">⚔️ ${tower.damage}</span>
                            <span class="text-blue-400">📡 ${tower.range}</span>
                        </div>
                        ${isDestroyer && !isDisabled ? '<div class="text-xs text-red-400 mt-1">⏰ 7 min</div>' : ''}
                        ${isDestroyer && isDisabled && gameState.currentWave < tower.availableAtWave ? `<div class="text-xs text-gray-300 mt-1">Unlocks at wave ${tower.availableAtWave}</div>` : ''}
                    </button>
                `;
            }).join('');
        }

        function getGridCoords(canvasX, canvasY) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: Math.floor((canvasX - rect.left) / CELL_SIZE),
                y: Math.floor((canvasY - rect.top) / CELL_SIZE)
            };
        }

        function handleTowerPlacement(event) {
            const { x, y } = getGridCoords(event.clientX, event.clientY);
            const key = `${x},${y}`;

            if (movingTower) {
                if (!TOWER_SLOTS.some(s => s.x === x && s.y === y)) {
                    showNotification("❌ Place towers on gray tiles only!", 2000, true);
                    movingTower = null;
                    drawDefenseScene();
                    return;
                }
                if (gameState.defense.towers[key]) {
                    showNotification("❌ Tile already occupied!", 2000, true);
                    movingTower = null;
                    drawDefenseScene();
                    return;
                }

                gameState.defense.towers[key] = movingTower.tower;
                showNotification(`✅ Tower moved to new location!`, 1500);
                movingTower = null;
                drawDefenseScene();
                return;
            }

            if (gameState.defense.towers[key]) {
                const tower = gameState.defense.towers[key];
                const towerDef = TOWERS[tower.typeId];
                
                if (towerDef.temporary) {
                    const timeElapsed = Date.now() - tower.placedAt;
                    const timeLeft = towerDef.duration - timeElapsed;
                    const minutes = Math.floor(timeLeft / 60000);
                    const seconds = Math.floor((timeLeft % 60000) / 1000);
                    
                    showModal(
                        `⏰ ${towerDef.name}`,
                        `<div class="text-left">
                            <p class="mb-2"><strong>Damage:</strong> ${towerDef.damage}</p>
                            <p class="mb-2"><strong>Range:</strong> ${towerDef.range}</p>
                            <p class="mb-2"><strong>Fire Rate:</strong> ${towerDef.fireRate}ms</p>
                            <p class="mb-3"><strong>Time Remaining:</strong> ${minutes}:${seconds.toString().padStart(2, '0')}</p>
                            <p class="text-sm text-red-400">⚠️ This tower cannot be sold or moved!</p>
                        </div>`,
                        [
                            { text: '❌ Close', action: 'window.hideModal()', class: 'bg-gray-600 hover:bg-gray-700' }
                        ]
                    );
                    return;
                }
                
                const sellPrice = Math.floor(towerDef.cost / 2);

                showModal(
                    `🗼 ${towerDef.name}`,
                    `<div class="text-left">
                        <p class="mb-2"><strong>Damage:</strong> ${towerDef.damage}</p>
                        <p class="mb-2"><strong>Range:</strong> ${towerDef.range}</p>
                        <p class="mb-2"><strong>Fire Rate:</strong> ${towerDef.fireRate}ms</p>
                        <p class="mb-3"><strong>Sell Value:</strong> 💰${sellPrice}</p>
                        <p class="text-sm text-gray-400">What would you like to do?</p>
                    </div>`,
                    [
                        { text: '💰 Sell', action: `window.sellTower('${key}', ${sellPrice})`, class: 'bg-yellow-600 hover:bg-yellow-700' },
                        { text: '🔄 Move', action: `window.moveTower('${key}')`, class: 'bg-blue-600 hover:bg-blue-700' },
                        { text: '❌ Cancel', action: 'window.hideModal()', class: 'bg-gray-600 hover:bg-gray-700' }
                    ]
                );
                return;
            }

            const towerDef = TOWERS.find(t => t.id === selectedTowerType);

            if (towerDef.availableAtWave && gameState.currentWave < towerDef.availableAtWave) {
                showNotification(`❌ ${towerDef.name} available at wave ${towerDef.availableAtWave}!`, 3000, true);
                return;
            }

            if (!TOWER_SLOTS.some(s => s.x === x && s.y === y)) {
                showNotification("❌ Place towers on gray tiles only!", 2000, true);
                return;
            }

            let actualCost = towerDef.cost;
            if (towerDef.id === 8) {
                actualCost = gameState.defense.destroyerPrices[key] || 
                            (gameState.defense.destroyerPrices['default'] || towerDef.cost);
            }

            if (gameState.coins < actualCost) {
                showNotification(`❌ Need ${actualCost} coins. You have ${gameState.coins}.`, 2000, true);
                return;
            }

            gameState.coins -= actualCost;
            
            const towerData = { 
                typeId: towerDef.id, 
                lastFired: 0 
            };
            
            if (towerDef.temporary) {
                towerData.placedAt = Date.now();
                gameState.defense.destroyerPrices[key] = actualCost + 500;
                gameState.defense.destroyerPrices['default'] = actualCost + 500;
            }
            
            gameState.defense.towers[key] = towerData;
            
            updateStatsUI();
            drawDefenseScene();
            showNotification(`✅ ${towerDef.name} placed!`, 1500);
        }

        function initDefenseGame() {
            PATH = gameState.currentTrack === 2 ? PATH2 : PATH1;
            calculateTowerSlots();

            gameContent.innerHTML = `
                <div class="w-full max-w-4xl fade-in">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-2xl font-bold text-indigo-400">🗼 Tower Defense ${gameState.currentTrack === 2 ? '🏁 RACE TRACK' : ''}</h2>
                        <div class="flex gap-2">
                            <button onclick="window.quitGame()"
                                    class="px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white font-semibold rounded-lg transition text-sm">
                                🚪 Quit Game
                            </button>
                            <button onclick="window.backToMenu()"
                                    class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition text-sm">
                                🏠 Back to Menu
                            </button>
                        </div>
                    </div>
                    <div id="defense-stats" class="flex flex-wrap justify-center gap-2 mb-3"></div>
                    <div class="defense-container mb-3 mx-auto">
                        <canvas id="gameCanvas" class="w-full h-full rounded-lg"></canvas>
                    </div>
                    <p class="text-xs text-yellow-400 mb-2 text-center">⚡ Select a tower below and click gray tiles to place it! Click existing towers to sell/move.</p>
                    <div id="tower-shop" class="grid grid-cols-2 sm:grid-cols-4 gap-2 mb-3 px-2"></div>
                    <div class="flex gap-3 flex-wrap justify-center pb-4">
                        <button id="start-wave-btn" onclick="window.startWave()" class="px-5 py-2 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 rounded-lg font-bold text-sm shadow-lg transition">
                            🚀 Start Wave ${gameState.currentWave + 1}
                        </button>
                    </div>
                </div>
            `;

            canvas = $('gameCanvas');
            const container = document.querySelector('.defense-container');
            const rect = container.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            ctx = canvas.getContext('2d');
            CELL_SIZE = canvas.width / GRID_SIZE;

            canvas.addEventListener('click', handleTowerPlacement);

            gameState.defense.blocks = [];
            gameState.defense.lasers = [];
            blocksSpawnedThisWave = 0;
            gameState.waveInProgress = false;
            gameState.isPaused = false;

            for (const key in gameState.defense.towers) {
                gameState.defense.towers[key].lastFired = 0;
            }

            clearInterval(gameLoopInterval);
            gameLoopInterval = setInterval(gameLoop, 1000 / 60);
            updateShopUI();
            updateStatsUI();
            drawDefenseScene();

            window.selectTower = (id) => {
                const towerDef = TOWERS.find(t => t.id === id);
                if (towerDef.availableAtWave && gameState.currentWave < towerDef.availableAtWave) {
                    showNotification(`❌ ${towerDef.name} available at wave ${towerDef.availableAtWave}!`, 3000, true);
                    return;
                }
                selectedTowerType = id;
                movingTower = null;
                updateShopUI();
                showNotification(`Selected: ${towerDef.name}`, 1500);
            };

            window.sellTower = (key, sellPrice) => {
                delete gameState.defense.towers[key];
                gameState.coins += sellPrice;
                hideModal();
                updateStatsUI();
                drawDefenseScene();
                showNotification(`✅ Tower sold for ${sellPrice} coins!`, 2000);
            };

            window.moveTower = (key) => {
                const tower = gameState.defense.towers[key];
                const towerDef = TOWERS[tower.typeId];
                
                if (towerDef.temporary) {
                    showNotification("❌ Cannot move temporary towers!", 2000, true);
                    hideModal();
                    return;
                }
                
                movingTower = { key: key, tower: gameState.defense.towers[key] };
                delete gameState.defense.towers[key];
                hideModal();
                drawDefenseScene();
                showNotification(`🔄 Click a gray tile to place the tower`, 2500);
            };

            window.startWave = () => {
                if (gameState.waveInProgress) return;

                blocksPerWave = 5 + Math.floor(gameState.currentWave * 1.5);
                blocksSpawnedThisWave = 0;
                gameState.waveInProgress = true;
                nextBlockSpawnTime = Date.now() + 500;

                const btn = $('start-wave-btn');
                if (btn) {
                    btn.textContent = `⚔️ Wave ${gameState.currentWave + 1} in progress...`;
                    btn.disabled = true;
                    btn.classList.add('opacity-50');
                }

                showNotification(`🌊 Wave ${gameState.currentWave + 1} started! ${blocksPerWave} enemies incoming!`, 2500);
            };

            window.backToMenu = () => {
                if (gameState.waveInProgress) {
                    showNotification('⚠️ Cannot go back to menu while wave is in progress!', 2500, true);
                    return;
                }
                clearInterval(gameLoopInterval);
                canvas.removeEventListener('click', handleTowerPlacement);
                saveGame();
                gameState.view = 'menu';
                render();
            };

            window.quitGame = () => {
                gameState.isPaused = true;
                showModal(
                    '🚪 Quit Game',
                    '<p>Are you sure you want to quit? Your progress will be saved automatically.</p>',
                    [
                        { text: '✅ Yes, Quit', action: 'window.confirmQuit()', class: 'bg-red-600 hover:bg-red-700' },
                        { text: '❌ No, Keep Playing', action: 'window.cancelQuit()', class: 'bg-green-600 hover:bg-green-700' }
                    ]
                );
            };

            window.confirmQuit = () => {
                clearInterval(gameLoopInterval);
                canvas.removeEventListener('click', handleTowerPlacement);
                saveGame();
                gameState.view = 'playerSetup';
                gameState.coins = 50;
                gameState.points = 0;
                gameState.currentWave = 0;
                gameState.enemiesKilled = 0;
                gameState.lives = 3;
                gameState.playerName = '';
                gameState.playerAge = '';
                gameState.playerPassword = '';
                gameState.isReturningPlayer = false;
                gameState.defense.towers = {};
                gameState.defense.blocks = [];
                gameState.defense.lasers = [];
                gameState.isPaused = false;
                gameState.waveInProgress = false;
                gameState.currentTrack = 1;
                PATH = PATH1;
                hideModal();
                render();
                showNotification('🔄 Game saved and reset. Welcome back!', 2500);
            };

            window.cancelQuit = () => {
                gameState.isPaused = false;
                hideModal();
                showNotification('▶️ Resuming game...', 1500);
            };
        }

        window.resetToMenu = () => {
            gameState.view = 'menu';
            gameState.coins = 50;
            gameState.points = 0;
            gameState.currentWave = 0;
            gameState.enemiesKilled = 0;
            gameState.lives = 3;
            gameState.defense.towers = {};
            gameState.defense.blocks = [];
            gameState.defense.lasers = [];
            gameState.isPaused = false;
            gameState.waveInProgress = false;
            gameState.currentTrack = 1;
            PATH = PATH1;
            hideModal();
            render();
        };

        async function render() {
            if (gameState.view === 'playerSetup') {
                // Carregar leaderboard do Supabase
                const topPlayers = await loadLeaderboard();
                
                gameContent.innerHTML = `
                    <div class="main-menu-card p-8 rounded-2xl mx-auto text-center fade-in" style="max-width: 600px;">
                        <h1 class="text-5xl font-extrabold text-center bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent mb-3">
                            🎯 Quiz Defends
                        </h1>
                        <p class="text-center text-sm text-gray-400 mb-8">
                            ${gameState.isReturningPlayer ? 'Welcome back! Please enter your password.' : 'Create an account to start playing'}
                        </p>

                        <div class="bg-gray-800 rounded-lg p-6 mb-6">
                            <h3 class="text-xl font-bold text-indigo-400 mb-4">${gameState.isReturningPlayer ? '🔐 Player Login' : '👤 Player Registration'}</h3>

                            <div class="mb-4 text-left">
                                <label class="block text-sm font-semibold text-gray-300 mb-2">Your Name</label>
                                <input type="text" id="player-name"
                                       class="w-full px-4 py-3 bg-gray-700 text-white rounded-lg border-2 ${gameState.isReturningPlayer ? 'border-green-500' : 'border-gray-600'} focus:border-indigo-500 focus:outline-none"
                                       placeholder="Enter your name" maxlength="20" ${gameState.isReturningPlayer ? 'readonly' : ''}>
                                ${gameState.isReturningPlayer ? '<p class="text-xs text-green-400 mt-1">✓ Player found! Please enter your password.</p>' : ''}
                            </div>

                            ${!gameState.isReturningPlayer ? `
                                <div class="mb-4 text-left">
                                    <label class="block text-sm font-semibold text-gray-300 mb-2">Your Age</label>
                                    <input type="number" id="player-age"
                                           class="w-full px-4 py-3 bg-gray-700 text-white rounded-lg border-2 border-gray-600 focus:border-indigo-500 focus:outline-none"
                                           placeholder="Enter your age" min="5" max="99">
                                </div>
                            ` : ''}

                            <div class="mb-6 text-left">
                                <label class="block text-sm font-semibold text-gray-300 mb-2">Password</label>
                                <div class="password-container">
                                    <input type="password" id="player-password"
                                           class="w-full px-4 py-3 bg-gray-700 text-white rounded-lg border-2 border-gray-600 focus:border-indigo-500 focus:outline-none pr-10"
                                           placeholder="${gameState.isReturningPlayer ? 'Enter your password' : 'Create a password (min 4 characters)'}" minlength="4">
                                    <button type="button" onclick="window.togglePassword()" class="password-toggle">
                                        👁️
                                    </button>
                                </div>
                                <p class="text-xs text-gray-400 mt-1">${gameState.isReturningPlayer ? 'Enter your password to continue' : 'Remember this password for future login'}</p>
                            </div>

                            <button id="start-game-btn"
                                    class="w-full py-4 px-6 text-white font-bold text-lg rounded-xl uppercase
                                           bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 shadow-lg transition">
                                ${gameState.isReturningPlayer ? '🔓 Login & Play' : '🚀 Register & Start Game'}
                            </button>

                            ${gameState.isReturningPlayer ? `
                                <button onclick="window.resetRegistration()"
                                        class="w-full mt-3 py-2 px-6 text-white font-semibold text-sm rounded-lg
                                               bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 shadow transition">
                                    👤 Not ${gameState.playerName}? Register as new player
                                </button>
                            ` : ''}
                        </div>

                        <div class="bg-gray-800 rounded-lg p-6">
                            <h3 class="text-xl font-bold text-yellow-400 mb-4">🏆 Top 10 Leaderboard</h3>
                            ${topPlayers.length > 0 ? `
                                <div class="space-y-2">
                                    ${topPlayers.map((player, idx) => `
                                        <div class="flex justify-between items-center p-3 bg-gray-700/50 rounded-lg hover:bg-gray-700 transition">
                                            <div class="flex items-center gap-3">
                                                <span class="font-bold ${idx === 0 ? 'text-yellow-400' : idx === 1 ? 'text-gray-300' : idx === 2 ? 'text-orange-400' : 'text-gray-400'}">#${idx + 1}</span>
                                                <div class="text-left">
                                                    <p class="font-bold text-white">${player.name}</p>
                                                    <p class="text-xs text-gray-400">Age: ${player.age}</p>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <p class="font-bold text-purple-400">${player.points} pts</p>
                                                <p class="text-xs text-gray-400">Wave ${player.wave + 1}</p>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : `
                                <p class="text-gray-400 text-sm">No players yet. Be the first!</p>
                            `}
                        </div>
                    </div>
                `;

                setTimeout(() => {
                    const startBtn = $('start-game-btn');
                    const nameInput = $('player-name');
                    const ageInput = $('player-age');
                    const passwordInput = $('player-password');

                    if (gameState.isReturningPlayer) {
                        nameInput.value = gameState.playerName;
                    }

                    window.togglePassword = () => {
                        const type = passwordInput.type === 'password' ? 'text' : 'password';
                        passwordInput.type = type;
                    };

                    window.resetRegistration = () => {
                        gameState.isReturningPlayer = false;
                        gameState.playerName = '';
                        gameState.playerAge = '';
                        render();
                        showNotification('🔄 Registration reset. Please enter new player details.', 2000);
                    };

                    nameInput.addEventListener('input', async () => {
                        if (!gameState.isReturningPlayer) {
                            const name = nameInput.value.trim();
                            const existingPlayer = await findExistingPlayer(name);
                            if (existingPlayer) {
                                gameState.isReturningPlayer = true;
                                gameState.playerName = name;
                                render();
                                showNotification(`👋 Player "${name}" already registered! Please enter your password.`, 3000);
                            }
                        }
                    });

                    startBtn.onclick = async () => {
                        const name = nameInput.value.trim();
                        let age = gameState.isReturningPlayer ? '' : ageInput.value.trim();
                        const password = passwordInput.value.trim();

                        if (!name || name.length < 2) {
                            showNotification("⚠️ Please enter a valid name (at least 2 characters)", 2500, true);
                            return;
                        }

                        if (!gameState.isReturningPlayer) {
                            if (!age || age < 5 || age > 99) {
                                showNotification("⚠️ Please enter a valid age (5-99)", 2500, true);
                                return;
                            }
                        }

                        if (!password || password.length < 4) {
                            showNotification("⚠️ Password must be at least 4 characters", 2500, true);
                            return;
                        }

                        if (gameState.isReturningPlayer) {
                            const isPasswordValid = await verifyPlayerPassword(name, password);
                            if (!isPasswordValid) {
                                showNotification("❌ Incorrect password! Please try again.", 3000, true);
                                return;
                            }
                            
                            const existingPlayer = await findExistingPlayer(name);
                            age = existingPlayer.age;
                            showNotification(`🎮 Welcome back, ${name}!`, 3000);
                        } else {
                            const existingPlayer = await findExistingPlayer(name);
                            if (existingPlayer) {
                                showNotification("⚠️ Player already exists! Please enter your password.", 3000, true);
                                gameState.isReturningPlayer = true;
                                gameState.playerName = name;
                                render();
                                return;
                            }
                            
                            showNotification(`🎉 Welcome, ${name}! Account created successfully.`, 3000);
                        }

                        gameState.playerName = name;
                        gameState.playerAge = age;
                        gameState.playerPassword = password;

                        // Tentar carregar jogo salvo
                        const hasSave = await loadGame();
                        if (!hasSave) {
                            gameState.coins = 50;
                            gameState.points = 0;
                            gameState.currentWave = 0;
                            gameState.enemiesKilled = 0;
                            gameState.lives = 3;
                            gameState.defense.towers = {};
                            gameState.defense.blocks = [];
                            gameState.defense.lasers = [];
                            gameState.currentTrack = 1;
                            gameState.quiz.answeredCategories = [];
                        } else {
                            showNotification("💾 Loaded saved game!", 3000);
                        }

                        await updatePlayerDatabase();

                        gameState.view = 'menu';
                        render();
                    };

                    nameInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            if (!gameState.isReturningPlayer && ageInput) {
                                ageInput.focus();
                            } else {
                                passwordInput.focus();
                            }
                        }
                    });
                    
                    if (!gameState.isReturningPlayer && ageInput) {
                        ageInput.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') passwordInput.focus();
                        });
                    }
                    
                    passwordInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') startBtn.click();
                    });

                    if (gameState.isReturningPlayer) {
                        passwordInput.focus();
                    } else {
                        nameInput.focus();
                    }
                }, 100);
            } else if (gameState.view === 'menu') {
                const allCategories = Object.keys(QUIZ_QUESTIONS);
                const availableCategories = allCategories.filter(cat => 
                    !gameState.quiz.answeredCategories.includes(cat)
                );

                gameContent.innerHTML = `
                    <div class="main-menu-card p-6 rounded-2xl mx-auto fade-in">
                        <div class="flex justify-between items-center mb-4">
                            <div>
                                <h1 class="text-3xl font-extrabold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                                    🎯 Quiz Defends
                                </h1>
                                <p class="text-sm text-gray-400">Player: ${gameState.playerName} (${gameState.playerAge})</p>
                                ${gameState.lastSave ? `<p class="text-xs text-green-400">Last save: ${new Date(gameState.lastSave).toLocaleTimeString()}</p>` : ''}
                            </div>
                            <div class="flex gap-2">
                                <button onclick="window.saveGameHandler()"
                                        class="px-3 py-1 ${gameState.waveInProgress ? 'bg-gray-500 cursor-not-allowed' : 'bg-green-600 hover:bg-green-700'} text-white text-xs font-semibold rounded-lg transition"
                                        ${gameState.waveInProgress ? 'disabled' : ''}
                                        title="${gameState.waveInProgress ? 'Cannot save during wave' : 'Save your progress'}">
                                    💾 Save
                                </button>
                                <button onclick="window.logoutHandler()"
                                        class="px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs font-semibold rounded-lg transition">
                                    🔓 Logout
                                </button>
                            </div>
                        </div>

                        <p class="text-center text-sm text-gray-400 mb-6">
                            ${gameState.isReturningPlayer ? 'Welcome back! ' : ''}Answer questions to earn coins, then build towers to defend!
                            ${gameState.quiz.answeredCategories.length > 0 ? `<br><span class="text-yellow-400">Completed: ${gameState.quiz.answeredCategories.length}/${allCategories.length} categories</span>` : ''}
                        </p>

                        <h3 class="text-lg font-bold text-center text-gray-300 mb-3">📚 Choose a Quiz Category</h3>
                        <div class="grid grid-cols-2 gap-3 mb-4">
                            ${allCategories.map(category => {
                                const isAnswered = gameState.quiz.answeredCategories.includes(category);
                                const isAvailable = availableCategories.includes(category);
                                return `
                                    <button onclick="${!isAnswered ? `window.startQuiz('${category}')` : ''}"
                                            class="category-card w-full py-3 px-4 text-white font-semibold rounded-xl
                                                   bg-gradient-to-br ${categoryColors[category]} ${isAnswered ? 'opacity-50 quiz-answered' : ''} shadow-lg"
                                            ${isAnswered ? 'disabled' : ''}
                                            title="${isAnswered ? 'Category completed. Complete other categories first.' : 'Click to start quiz'}">
                                        <span class="text-xl">${categoryEmojis[category]}</span>
                                        <div class="mt-1 text-sm font-normal">${category}</div>
                                        ${isAnswered ? '<div class="text-xs mt-1">🔒 Completed</div>' : ''}
                                    </button>
                                `;
                            }).join('')}
                        </div>

                        <div class="flex flex-col sm:flex-row gap-3 justify-center">
                            <button onclick="window.continueGame()"
                                    class="flex-1 py-3 px-6 text-white font-bold text-lg rounded-xl bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 shadow-lg transition flex items-center justify-center gap-2">
                                🏰 Continue Defense
                            </button>
                            <button onclick="window.showInstructions()"
                                    class="flex-1 py-3 px-6 text-white font-bold text-lg rounded-xl bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700 shadow-lg transition flex items-center justify-center gap-2">
                                📖 How to Play
                            </button>
                        </div>

                        ${availableCategories.length === 0 ? `
                            <div class="mt-4 p-3 bg-yellow-900/30 border border-yellow-700 rounded-lg text-center">
                                <p class="text-yellow-400 font-semibold">🎉 All categories completed!</p>
                                <p class="text-sm text-yellow-300">All categories have been unlocked again. Keep playing!</p>
                            </div>
                        ` : ''}
                    </div>
                `;

                setTimeout(() => {
                    window.saveGameHandler = async () => {
                        if (gameState.waveInProgress) {
                            showNotification('⚠️ Cannot save during wave!', 2500, true);
                            return;
                        }
                        if (await saveGame()) {
                            showNotification('💾 Game saved successfully!', 2000);
                        } else {
                            showNotification('❌ Failed to save game', 2000, true);
                        }
                    };

                    window.logoutHandler = async () => {
                        if (gameState.waveInProgress) {
                            showNotification('⚠️ Cannot logout during wave!', 2500, true);
                            return;
                        }
                        await saveGame();
                        gameState.view = 'playerSetup';
                        gameState.playerName = '';
                        gameState.playerAge = '';
                        gameState.playerPassword = '';
                        gameState.isReturningPlayer = false;
                        render();
                        showNotification('🔓 Logged out successfully', 2000);
                    };

                    window.startQuiz = (category) => {
                        if (gameState.quiz.answeredCategories.includes(category)) {
                            showNotification("❌ This category is already completed. Choose another category!", 3000, true);
                            return;
                        }
                        
                        gameState.view = 'quiz';
                        gameState.quiz.category = category;
                        const questions = [...QUIZ_QUESTIONS[category]];
                        for (let i = questions.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [questions[i], questions[j]] = [questions[j], questions[i]];
                        }
                        gameState.quiz.questions = questions.slice(0, 5);
                        gameState.quiz.index = 0;
                        gameState.quiz.score = 0;
                        gameState.quiz.waitingForNext = false;
                        gameState.quiz.currentShuffledOptions = [];
                        gameState.quiz.currentCorrectIndex = -1;
                        render();
                    };

                    window.continueGame = () => {
                        if (gameState.waveInProgress) {
                            showNotification('⚠️ Already in a wave!', 2500, true);
                            return;
                        }
                        gameState.view = 'defense';
                        initDefenseGame();
                    };

                    window.showInstructions = () => {
                        showModal(
                            '📖 How to Play',
                            `<div class="text-left space-y-2">
                                <p><strong>1. Quiz Mode:</strong> Answer 5 questions to earn coins.</p>
                                <p><strong>2. Tower Defense:</strong> Use coins to build towers.</p>
                                <p><strong>3. Categories:</strong> Each category can only be completed once per cycle.</p>
                                <p><strong>4. Towers:</strong> Click gray tiles to place, click towers to sell/move.</p>
                                <p><strong>5. Waves:</strong> Survive waves of enemies. Lose if 3 get through.</p>
                                <p><strong>6. New Tracks:</strong> Unlock Race Track at wave 50.</p>
                                <p><strong>7. Save System:</strong> Game auto-saves when returning to menu.</p>
                                <p class="text-sm text-yellow-400 mt-3">💡 Tip: Complete all quiz categories to unlock them again!</p>
                            </div>`,
                            [{ text: '✅ Got it!', action: 'window.hideModal()', class: 'bg-indigo-600 hover:bg-indigo-700' }]
                        );
                    };
                }, 100);
            } else if (gameState.view === 'quiz') {
                if (gameState.quiz.index >= 5) {
                    const coinsEarned = 50 + (gameState.quiz.score * 10);
                    gameState.coins += coinsEarned;
                    gameState.points += gameState.quiz.score * 5;
                    
                    showNotification(`✅ Quiz complete! Score: ${gameState.quiz.score}/5. Earned: ${coinsEarned} coins`, 3000);
                    
                    setTimeout(() => {
                        handleQuizCompletion();
                    }, 2000);
                    return;
                }

                const currentQ = gameState.quiz.questions[gameState.quiz.index];
                const category = gameState.quiz.category;
                
                const options = [...currentQ.options];
                const correctAnswer = currentQ.a;
                
                for (let i = options.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [options[i], options[j]] = [options[j], options[i]];
                }
                
                gameState.quiz.currentShuffledOptions = options;
                gameState.quiz.currentCorrectIndex = options.indexOf(correctAnswer);
                
                gameContent.innerHTML = `
                    <div class="main-menu-card p-6 rounded-2xl mx-auto fade-in" style="max-width: 500px;">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-indigo-400">${categoryEmojis[category]} ${category} Quiz</h2>
                            <div class="text-right">
                                <div class="text-lg font-bold text-yellow-400">Score: ${gameState.quiz.score}/5</div>
                                <div class="text-sm text-gray-400">Question ${gameState.quiz.index + 1}/5</div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-800 rounded-xl p-5 mb-6 shadow-inner">
                            <h3 class="text-xl font-bold text-white mb-4 text-center">${currentQ.q}</h3>
                            <div class="space-y-3">
                                ${options.map((opt, idx) => `
                                    <button onclick="window.answerQuestion(${idx})"
                                            class="w-full py-3 px-4 text-left bg-gray-700 hover:bg-gray-600 text-white font-semibold rounded-lg transition duration-200 border border-gray-600 hover:border-${categoryColors[category].split(' ')[0].replace('from-', '')}">
                                        ${String.fromCharCode(65 + idx)}) ${opt}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="flex justify-center">
                            <button onclick="window.backToMenuFromQuiz()"
                                    class="px-5 py-2 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition">
                                🏠 Back to Menu
                            </button>
                        </div>
                    </div>
                `;

                setTimeout(() => {
                    window.answerQuestion = (idx) => {
                        if (gameState.quiz.waitingForNext) return;
                        
                        const isCorrect = idx === gameState.quiz.currentCorrectIndex;
                        
                        if (isCorrect) {
                            gameState.quiz.score++;
                            showNotification('✅ Correct! +10 coins', 1500);
                        } else {
                            const correctAnswer = gameState.quiz.currentShuffledOptions[gameState.quiz.currentCorrectIndex];
                            showNotification(`❌ Wrong! Correct: ${correctAnswer}`, 1500, true);
                        }
                        
                        gameState.quiz.waitingForNext = true;
                        gameState.quiz.index++;
                        
                        setTimeout(() => {
                            gameState.quiz.waitingForNext = false;
                            render();
                        }, 1500);
                    };

                    window.backToMenuFromQuiz = () => {
                        showModal(
                            '⚠️ Leave Quiz',
                            '<p>Are you sure you want to leave? Progress will be lost.</p>',
                            [
                                { text: '✅ Yes, Leave', action: 'window.confirmLeaveQuiz()', class: 'bg-red-600 hover:bg-red-700' },
                                { text: '❌ No, Continue', action: 'window.hideModal()', class: 'bg-green-600 hover:bg-green-700' }
                            ]
                        );
                    };

                    window.confirmLeaveQuiz = () => {
                        hideModal();
                        gameState.view = 'menu';
                        gameState.quiz.category = null;
                        gameState.quiz.questions = [];
                        gameState.quiz.index = 0;
                        gameState.quiz.score = 0;
                        gameState.quiz.currentShuffledOptions = [];
                        gameState.quiz.currentCorrectIndex = -1;
                        render();
                        showNotification('Quiz cancelled', 2000);
                    };
                }, 100);
            }
        }

        // Initialize the game
        render();
    </script>
</body>
</html>
